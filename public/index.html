<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeSense Respiro - Environmental Monitoring Network</title>

    <!-- Apply dark mode immediately to prevent flash -->
    <script>
        if (localStorage.getItem('darkMode') === 'true') {
            document.documentElement.classList.add('dark-mode');
        }
    </script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <style>
        :root {
            --bg-primary: #f5f5f5;
            --bg-secondary: white;
            --bg-tertiary: #f9f9f9;
            --text-primary: #222;
            --text-secondary: #555;
            --text-muted: #777;
            --border-color: #d0d0d0;
            --accent-color: #667eea;
            --accent-color-2: #764ba2;
            /* Base font sizes for better readability */
            --font-xs: 12px;
            --font-sm: 13px;
            --font-base: 14px;
            --font-md: 15px;
            --font-lg: 16px;
        }

        html.dark-mode,
        body.dark-mode {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #333;
            --text-primary: #f0f0f0;
            --text-secondary: #b0b0b0;
            --text-muted: #888;
            --border-color: #555;
            --accent-color: #7b93f5;
            --accent-color-2: #8b5fb8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        #container {
            display: flex;
            height: 100%;
        }
        
        #map {
            flex: 1;
            z-index: 1;
            background: #0a1628; /* Dark ocean for satellite/hybrid */
        }

        /* Street layer ocean background */
        #map.street-layer {
            background: #aad3df;
        }

        /* Dark mode filter for street layer (CartoDB Voyager) */
        body.dark-mode #map.street-layer {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
            background: #223344; /* Darker background for inverted street */
        }

        .sidebar {
            width: 350px;
            background: var(--bg-secondary);
            box-shadow: -2px 0 8px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            z-index: 10;
        }
        
        .header-buttons {
            display: flex;
            gap: 2px;
            margin-left: auto;
            align-self: flex-start;
            flex-shrink: 0;
        }

        .header-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            opacity: 0.8;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-btn svg {
            display: block;
        }

        .header-btn svg.spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-btn:hover {
            opacity: 1;
        }

        .header-btn:disabled {
            cursor: not-allowed;
        }

        .header-btn.active {
            opacity: 1;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .region-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .region-metric-select {
            display: none;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            outline: none;
        }

        .region-metric-select:focus {
            border-color: rgba(255, 255, 255, 0.6);
        }

        .region-metric-select option {
            background: #333;
            color: white;
        }

        .region-controls.active .region-metric-select {
            display: block;
        }

        .sidebar-header {
            padding: 5px 20px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-color-2) 100%);
            color: white;
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
        }
        
        .header-content {
            flex: 1;
        }
        
        .sidebar-header h1, .sidebar-header h2 {
            font-size: 18px;
            margin-bottom: 2px;
        }

        .sidebar-header p {
            font-size: var(--font-xs);
            opacity: 0.9;
            margin-bottom: 0;
        }

        .timeframe-selector {
            display: flex;
            gap: 4px;
            margin-top: 10px;
            flex-wrap: nowrap;
        }

        .timeframe-btn {
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .timeframe-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .timeframe-btn.active {
            background: rgba(255, 255, 255, 0.8);
            color: #667eea;
            font-weight: bold;
        }

        .aging-bar-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            font-size: 10px;
        }

        .aging-bar-label {
            width: 35px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            text-align: right;
            margin-right: 6px;
        }

        .aging-bar-container {
            flex: 1;
            height: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        }

        .aging-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.4));
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 4px;
        }

        .aging-bar-count {
            color: white;
            font-weight: 600;
            font-size: 11px;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
        }

        .aging-bar-item.active .aging-bar-fill {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.9), rgba(255, 195, 0, 0.7));
        }

        .aging-bar-item.active .aging-bar-count {
            color: #333;
            text-shadow: 0 0 3px rgba(255,255,255,0.5);
        }

        .aging-bar-item.active .aging-bar-label {
            color: #FFD700;
            font-weight: 700;
        }

        .filters {
            padding: 15px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .filter-group {
            margin-bottom: 12px;
        }
        
        .filter-group:last-child {
            margin-bottom: 0;
        }
        
        .filter-label {
            font-size: var(--font-xs);
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            user-select: none;
        }

        .filter-label:hover {
            color: var(--accent-color);
        }

        .filter-label::after {
            content: 'â–¼';
            font-size: 9px;
            transition: transform 0.2s ease;
        }
        
        .filter-label.collapsed::after {
            transform: rotate(-90deg);
        }
        
        .filter-summary {
            font-size: 11px;
            color: var(--accent-color);
            font-weight: normal;
            margin-left: 8px;
        }
        
        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            max-height: 150px;
            overflow-y: auto;
            overflow-x: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
            padding-right: 5px;
        }
        
        .filter-options.collapsed {
            max-height: 0;
            opacity: 0;
            margin-top: 0;
            overflow: hidden;
        }
        
        .filter-options::-webkit-scrollbar {
            width: 6px;
        }
        
        .filter-options::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }
        
        .filter-options::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }
        
        .filter-options::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color);
        }
        
        .filter-btn {
            padding: 4px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: var(--font-xs);
            transition: all 0.2s ease;
        }
        
        .filter-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
        }
        
        .filter-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            font-weight: bold;
        }
        
        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .stat-label {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Collapsible sidebar sections */
        .sidebar-section {
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-section:last-child {
            border-bottom: none;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: var(--bg-tertiary);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s ease;
        }

        .section-header:hover {
            background: var(--bg-secondary);
        }

        .section-header h3 {
            margin: 0;
            font-size: var(--font-xs);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .time-filter-value {
            color: var(--accent-color);
            font-weight: normal;
            text-transform: none;
        }

        .section-toggle {
            font-size: 10px;
            color: var(--text-secondary);
            transition: transform 0.2s ease;
        }

        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
        }

        .section-content {
            transition: max-height 0.3s ease, opacity 0.2s ease, padding 0.3s ease;
            overflow: hidden;
        }

        .section-content.collapsed {
            max-height: 0 !important;
            opacity: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }

        /* Adjust existing styles for collapsible sections */
        .stats.section-content {
            max-height: 200px;
        }

        .filters.section-content {
            max-height: 400px;
            padding: 15px;
        }

        .sensors-list.section-content {
            max-height: none;
        }

        /* Leaderboard styles */
        .leaderboard-content {
            max-height: 280px;
            overflow-y: auto;
        }

        .leaderboard-section {
            margin-bottom: 6px;
        }

        .leaderboard-section:last-child {
            margin-bottom: 0;
        }

        .leaderboard-section-header {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
            padding-left: 2px;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 1px 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            font-size: var(--font-xs);
        }

        .leaderboard-rank {
            font-weight: bold;
            color: var(--accent-color);
            min-width: 20px;
        }

        .leaderboard-rank.gold { color: #FFD700; }
        .leaderboard-rank.silver { color: #C0C0C0; }
        .leaderboard-rank.bronze { color: #CD7F32; }

        .leaderboard-region {
            flex: 1;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .leaderboard-count {
            font-weight: 600;
            color: var(--accent-color);
            background: var(--bg-tertiary);
            padding: 1px 6px;
            border-radius: 8px;
            font-size: 10px;
        }

        .leaderboard-empty {
            color: var(--text-secondary);
            font-size: var(--font-xs);
            text-align: center;
            padding: 10px;
        }

        .leaderboard-loading {
            color: var(--text-secondary);
            font-size: var(--font-xs);
            text-align: center;
            padding: 10px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .sensors-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        
        .sensor-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .sensor-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
        }
        
        .sensor-item.active {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }
        
        .sensor-name {
            font-weight: 600;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .sensor-meta {
            font-size: var(--font-xs);
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .sensor-readings {
            display: grid;
            gap: 4px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .reading {
            font-size: var(--font-xs);
            padding: 4px 0;
            border-top: 1px solid var(--border-color);
        }
        
        .reading:first-child {
            border-top: none;
        }
        
        .reading-type {
            color: var(--accent-color);
            font-weight: 500;
        }
        
        .reading-value {
            color: var(--text-primary);
            margin-left: 5px;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
        }

        .empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .empty-icon {
            font-size: 40px;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        .empty-icon.loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .empty-icon.star-icon {
            width: 40px;
            height: 40px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpolygon points='12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2'/%3E%3C/svg%3E") center/contain no-repeat;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .info-window {
            min-width: 300px;
            max-width: 320px;
        }
        
        .info-window-title {
            font-weight: 600;
            margin-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
        }
        
        .info-window-content {
            font-size: var(--font-base);
            line-height: 1.6;
            display: flex;
            gap: 10px;
        }
        
        .leaflet-popup-content {
            margin: 0 !important;
        }

        .leaflet-popup-content-wrapper {
            border-radius: 4px;
        }

        /* Dark mode styles for popups on all map layers */
        body.dark-mode .leaflet-popup-content-wrapper {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        body.dark-mode .leaflet-popup-tip {
            background-color: #2d2d2d;
        }

        body.dark-mode .info-window-title {
            color: #e0e0e0;
            border-bottom-color: #444;
        }

        body.dark-mode .info-window-content {
            color: #e0e0e0;
        }

        body.dark-mode .info-window-content p {
            color: #e0e0e0;
        }

        body.dark-mode .info-window-content strong {
            color: #f0f0f0;
        }

        body.dark-mode .leaflet-popup-close-button {
            color: #e0e0e0 !important;
        }

        body.dark-mode .leaflet-popup-close-button:hover {
            color: #ffffff !important;
        }

        /* Dark mode styles for tooltips on all map layers */
        body.dark-mode .leaflet-tooltip {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border: 1px solid #444;
        }

        body.dark-mode .leaflet-tooltip-top:before,
        body.dark-mode .leaflet-tooltip-bottom:before,
        body.dark-mode .leaflet-tooltip-left:before,
        body.dark-mode .leaflet-tooltip-right:before {
            border-top-color: #2d2d2d;
            border-bottom-color: #2d2d2d;
            border-left-color: #2d2d2d;
            border-right-color: #2d2d2d;
        }

        /* Region overlay tooltip styles */
        .region-tooltip {
            background-color: rgba(45, 45, 45, 0.95);
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .region-tooltip-content strong {
            color: #fff;
            font-size: 14px;
        }

        .leaflet-tooltip.region-tooltip::before {
            display: none;
        }

        /* Counter-invert popups and tooltips on street layer to maintain dark mode appearance */
        body.dark-mode #map.street-layer .leaflet-popup-content-wrapper,
        body.dark-mode #map.street-layer .leaflet-popup-tip,
        body.dark-mode #map.street-layer .leaflet-tooltip {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
        }

        /* Dark mode styles for geocoder search control - JS will handle detailed styling */
        body.dark-mode .leaflet-control-geocoder-alternatives {
            background-color: #2d2d2d;
            border-color: #444;
        }

        body.dark-mode .leaflet-control-geocoder-alternatives a {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border-bottom-color: #444;
        }

        body.dark-mode .leaflet-control-geocoder-alternatives a:hover {
            background-color: #3d3d3d;
        }

        /* Counter-invert geocoder on street layer to maintain dark appearance */
        body.dark-mode #map.street-layer .leaflet-control-geocoder,
        body.dark-mode #map.street-layer .leaflet-control-geocoder-form,
        body.dark-mode #map.street-layer .leaflet-control-geocoder-alternatives {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
        }

        /* Dark mode styles for zoom controls */
        body.dark-mode .leaflet-control-zoom a {
            background-color: #2d2d2d;
            color: #e0e0e0;
            border-color: #444;
        }

        body.dark-mode .leaflet-control-zoom a:hover {
            background-color: #3d3d3d;
            color: #ffffff;
        }

        body.dark-mode .leaflet-bar {
            border-color: #444;
        }

        /* Counter-invert zoom controls on street layer */
        body.dark-mode #map.street-layer .leaflet-control-zoom {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
        }

        /* Viewer counter overlay */
        .viewer-counter {
            position: absolute;
            bottom: 25px;
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            color: #666;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
            cursor: default;
        }

        .viewer-counter #viewerCount {
            font-weight: bold;
            color: #333;
        }

        body.dark-mode .viewer-counter {
            background: rgba(50, 50, 50, 0.9);
            color: #aaa;
        }

        body.dark-mode .viewer-counter #viewerCount {
            color: #fff;
        }

        /* Counter-invert viewer counter on street layer in dark mode */
        body.dark-mode #map.street-layer .viewer-counter {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
        }

        /* Map overlay controls for region filters */
        .map-overlay-controls {
            position: absolute;
            top: 10px;
            left: 60px;
            z-index: 1000;
            display: none;
            gap: 8px;
            align-items: center;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .map-overlay-controls.active {
            display: flex;
        }

        .map-overlay-controls select {
            background: white;
            border: 1px solid #ccc;
            color: #333;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            outline: none;
        }

        .map-overlay-controls select:focus {
            border-color: var(--accent-color);
        }

        .map-overlay-controls select option {
            background: white;
            color: #333;
        }

        .map-overlay-controls .control-label {
            font-size: 11px;
            font-weight: 600;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        body.dark-mode .map-overlay-controls {
            background: rgba(45, 45, 45, 0.95);
            border-color: #444;
        }

        body.dark-mode .map-overlay-controls select {
            background: #3d3d3d;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .map-overlay-controls select option {
            background: #3d3d3d;
            color: #e0e0e0;
        }

        body.dark-mode .map-overlay-controls .control-label {
            color: #aaa;
        }

        /* Historical toggle checkbox */
        .map-overlay-controls .historical-toggle {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
            padding: 4px 8px;
            border-radius: 4px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            margin-left: 4px;
        }

        .map-overlay-controls .historical-toggle:hover {
            background: #eee;
        }

        .map-overlay-controls .historical-toggle input {
            margin: 0;
            cursor: pointer;
        }

        .map-overlay-controls .historical-toggle.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        body.dark-mode .map-overlay-controls .historical-toggle {
            background: #3d3d3d;
            border-color: #555;
            color: #ccc;
        }

        body.dark-mode .map-overlay-controls .historical-toggle:hover {
            background: #4d4d4d;
        }

        body.dark-mode .map-overlay-controls .historical-toggle.active {
            background: var(--accent-color);
            color: white;
        }

        /* Historical controls container */
        .map-overlay-controls .historical-controls {
            display: none;
            align-items: center;
            gap: 8px;
            padding-left: 8px;
            border-left: 1px solid #ddd;
            margin-left: 4px;
        }

        .map-overlay-controls .historical-controls.visible {
            display: flex;
        }

        body.dark-mode .map-overlay-controls .historical-controls {
            border-left-color: #555;
        }

        /* Date picker */
        .map-overlay-controls input[type="date"] {
            background: white;
            border: 1px solid #ccc;
            color: #333;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .map-overlay-controls input[type="date"]:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        body.dark-mode .map-overlay-controls input[type="date"] {
            background: #3d3d3d;
            border-color: #555;
            color: #e0e0e0;
        }

        /* Hour slider container */
        .map-overlay-controls .hour-slider-container {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .map-overlay-controls input[type="range"] {
            width: 80px;
            height: 4px;
            -webkit-appearance: none;
            appearance: none;
            background: #ddd;
            border-radius: 2px;
            cursor: pointer;
        }

        .map-overlay-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 14px;
            height: 14px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .map-overlay-controls input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        body.dark-mode .map-overlay-controls input[type="range"] {
            background: #555;
        }

        .map-overlay-controls #regionHourLabel {
            font-size: 11px;
            font-weight: 600;
            color: #666;
            min-width: 40px;
        }

        body.dark-mode .map-overlay-controls #regionHourLabel {
            color: #aaa;
        }

        /* Historical indicator badge */
        .map-overlay-controls .historical-indicator {
            display: none;
            font-size: 10px;
            background: var(--accent-color);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }

        .map-overlay-controls .historical-indicator.visible {
            display: inline-block;
        }

        /* Multi-select dropdown styles */
        .multi-select-dropdown {
            position: relative;
            display: inline-block;
        }

        .multi-select-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            background: white;
            border: 1px solid #ccc;
            color: #333;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            outline: none;
            min-width: 120px;
        }

        .multi-select-toggle:hover {
            border-color: var(--accent-color);
        }

        .multi-select-label {
            flex: 1;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 140px;
        }

        .dropdown-arrow {
            flex-shrink: 0;
            transition: transform 0.2s;
        }

        .multi-select-dropdown.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .multi-select-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1001;
            min-width: 160px;
            max-height: 280px;
            overflow-y: auto;
        }

        .multi-select-dropdown.open .multi-select-options {
            display: block;
        }

        .multi-select-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            color: #333;
            transition: background 0.15s;
        }

        .multi-select-option:hover {
            background: #f5f5f5;
        }

        .multi-select-option input[type="checkbox"] {
            margin: 0;
            cursor: pointer;
        }

        .multi-select-option.select-all {
            font-weight: 600;
            border-bottom: 1px solid #eee;
        }

        .multi-select-divider {
            height: 1px;
            background: #eee;
            margin: 4px 0;
        }

        body.dark-mode .multi-select-toggle {
            background: #3d3d3d;
            border-color: #555;
            color: #e0e0e0;
        }

        body.dark-mode .multi-select-options {
            background: #3d3d3d;
            border-color: #555;
        }

        body.dark-mode .multi-select-option {
            color: #e0e0e0;
        }

        body.dark-mode .multi-select-option:hover {
            background: #4a4a4a;
        }

        body.dark-mode .multi-select-option.select-all {
            border-bottom-color: #555;
        }

        body.dark-mode .multi-select-divider {
            background: #555;
        }

        /* Counter-invert map overlay controls on street layer */
        body.dark-mode #map.street-layer .map-overlay-controls {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
        }

        /* Dark mode styles for layer control */
        body.dark-mode .leaflet-control-layers {
            background-color: #2d2d2d;
            border-color: #444;
        }

        body.dark-mode .leaflet-control-layers-toggle {
            background-color: #2d2d2d;
            filter: invert(1);
        }

        body.dark-mode .leaflet-control-layers-expanded {
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        body.dark-mode .leaflet-control-layers-base label,
        body.dark-mode .leaflet-control-layers-overlays label {
            color: #e0e0e0;
        }

        /* Counter-invert layer control on street layer */
        body.dark-mode #map.street-layer .leaflet-control-layers,
        body.dark-mode #map.street-layer .leaflet-control-layers-toggle {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
        }

        /* Heatmap toggle control */
        .heatmap-toggle-control {
            background: white;
            border-radius: 4px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.4);
            cursor: pointer;
        }

        .heatmap-toggle-control button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 34px;
            height: 34px;
            border: none;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            color: #666;
            transition: background-color 0.2s, color 0.2s;
        }

        .heatmap-toggle-control button:hover {
            background: #f4f4f4;
            color: #333;
        }

        .heatmap-toggle-control button.active {
            background: #667eea;
            color: white;
        }

        .heatmap-toggle-control button.active:hover {
            background: #5a6fd6;
        }

        .heatmap-toggle-control button svg {
            width: 18px;
            height: 18px;
        }

        .heatmap-toggle-control button.loading svg {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        body.dark-mode .heatmap-toggle-control {
            background: #2d2d2d;
        }

        body.dark-mode .heatmap-toggle-control button {
            background: #2d2d2d;
            color: #ccc;
        }

        body.dark-mode .heatmap-toggle-control button:hover {
            background: #3d3d3d;
            color: #fff;
        }

        body.dark-mode .heatmap-toggle-control button.active {
            background: #667eea;
            color: white;
        }

        /* Counter-invert on street layer for dark mode */
        body.dark-mode #map.street-layer .heatmap-toggle-control {
            filter: invert(0.9) hue-rotate(180deg) brightness(1.1);
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 280px;
                display: block;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            /* Compact layout for landscape mobile/tablets */
            .sidebar-header {
                padding: 12px;
            }

            .sidebar-header h1 {
                font-size: 18px;
            }

            .sidebar-header p {
                font-size: var(--font-sm);
            }

            /* Hide activity distribution section on small screens to save space */
            .sidebar-section:has(#agingChart) {
                display: none;
            }

            .stats {
                padding: 8px;
            }

            .stat {
                padding: 10px;
            }

            /* Make sensors list not scrollable - let sidebar scroll instead */
            .sensors-list {
                flex: none;
                overflow-y: visible;
                padding-bottom: 20px;
            }

            /* Fix mobile scrolling: disable inner scroll, let sidebar scroll */
            .sensor-readings {
                max-height: none;
                overflow-y: visible;
            }
        }

        @media (max-width: 600px) {
            #container {
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }

            .sidebar {
                width: 100%;
                height: 50%;
                order: 2;
                border-bottom: 1px solid var(--border-color);
                display: block;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            #map {
                height: 50%;
                order: 1;
                overflow: hidden;
            }

            /* Compact header on mobile */
            .sidebar-header {
                padding: 10px;
            }

            .sidebar-header h1 {
                font-size: 17px;
                margin-bottom: 3px;
            }

            .sidebar-header p {
                font-size: var(--font-xs);
                margin-bottom: 5px;
            }

            /* Hide activity distribution section on mobile to save space */
            .sidebar-section:has(#agingChart) {
                display: none;
            }

            /* Compact timeframe buttons */
            .timeframe-btn {
                padding: 5px 10px;
                font-size: var(--font-xs);
            }

            /* Compact stats - 2 columns instead of 4 */
            .stats {
                padding: 8px;
                gap: 8px;
            }

            .stat {
                padding: 8px;
            }

            .stat-value {
                font-size: 20px;
            }

            .stat-label {
                font-size: var(--font-xs);
            }

            /* Compact filters */
            .filters {
                padding: 8px 10px;
            }

            .filter-label {
                padding: 6px 8px;
                font-size: var(--font-sm);
            }

            /* Make sensors list not scrollable - let sidebar scroll instead */
            .sensors-list {
                flex: none;
                overflow-y: visible;
                padding-bottom: 20px;
            }

            /* Fix mobile scrolling: disable inner scroll, let sidebar scroll */
            .sensor-readings {
                max-height: none;
                overflow-y: visible;
            }
        }
        
        /* Custom sensor marker styling */
        .custom-sensor-marker {
            background: transparent;
            border: none;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .custom-sensor-marker:hover {
            transform: scale(1.15);
        }
        
        .custom-sensor-marker svg {
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        /* Help Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 12px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-color-2) 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 32px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            line-height: 32px;
            text-align: center;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .modal-close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 24px;
        }

        .legend-section {
            margin-bottom: 24px;
        }

        .legend-section:last-child {
            margin-bottom: 0;
        }

        .legend-section h3 {
            font-size: 16px;
            margin: 0 0 12px 0;
            color: var(--text-primary);
        }

        .legend-section p {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0 0 12px 0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            font-size: 14px;
        }

        .legend-position {
            font-weight: 600;
            min-width: 80px;
            color: var(--accent-color);
        }

        .legend-icon {
            font-weight: 600;
            min-width: 100px;
            font-size: 16px;
        }

        .legend-metric {
            flex: 1;
            color: var(--text-secondary);
        }

        .color-scale {
            display: flex;
            gap: 4px;
            margin: 12px 0 8px 0;
            height: 30px;
            border-radius: 4px;
            overflow: hidden;
        }

        .color-sample {
            flex: 1;
        }

        .color-labels {
            display: flex;
            justify-content: space-between;
            font-size: var(--font-base);
            color: var(--text-secondary);
        }

        /* Main Navigation */
        .main-nav {
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-color-2) 100%);
            color: white;
            display: flex;
            align-items: center;
            padding: 12px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-brand h1 {
            font-size: 20px;
            margin: 0;
            font-weight: 600;
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-left: 40px;
        }

        .nav-tab {
            background: rgba(255,255,255,0.1);
            border: none;
            color: rgba(255,255,255,0.8);
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-tab:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.25);
            color: white;
            font-weight: 600;
        }

        .nav-separator {
            color: rgba(255,255,255,0.3);
            font-size: 18px;
            font-weight: 300;
            margin: 0 4px;
            align-self: center;
        }

        .nav-controls {
            margin-left: auto;
            display: flex;
            gap: 4px;
        }

        /* View Containers */
        .view-container {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .view-container.active {
            display: block;
        }

        /* Safari fix: ensure nav stays visible */
        .main-nav {
            flex-shrink: 0;
            position: relative;
        }

        /* Dashboard Styles */
        #dashboardView {
            background: var(--bg-primary);
            overflow-y: auto;
        }

        .dashboard-content {
            padding: 20px;
        }

        .dash-view {
            display: none;
        }

        .dash-view.active {
            display: block;
        }

        /* Sensors Header */
        .sensors-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .sensors-header h2 {
            font-size: 24px;
            color: var(--text-primary);
            margin: 0;
        }

        .sensors-count {
            font-size: 14px;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .back-to-dashboard-btn {
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 0;
            transition: opacity 0.2s;
        }

        .back-to-dashboard-btn:hover {
            opacity: 0.8;
        }

        .overview-search {
            margin-bottom: 16px;
        }

        .overview-search input {
            width: 100%;
            max-width: 400px;
            padding: 10px 16px;
            font-size: 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .overview-search input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .overview-search input::placeholder {
            color: var(--text-secondary);
        }

        /* Sensors Grid */
        .sensors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        /* Sensor Card - Scoped to dashboard */
        #dashboardView .sensor-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        #dashboardView .sensor-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.12);
        }

        #dashboardView .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }

        #dashboardView .card-title {
            flex: 1;
        }

        #dashboardView .card-title h3 {
            font-size: 16px;
            margin: 0 0 4px 0;
            color: var(--text-primary);
        }

        #dashboardView .card-title .device-id {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            font-family: monospace;
        }

        #dashboardView .card-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #64748b;
        }
        #dashboardView .card-status.active {
            background: #22c55e;
        }
        #dashboardView .card-status.inactive {
            background: #64748b;
        }

        /* Readings Grid - Scoped to dashboard only */
        #dashboardView .readings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        #dashboardView .reading-item {
            text-align: center;
        }

        #dashboardView .reading-label {
            font-size: var(--font-sm);
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        #dashboardView .reading-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 4px;
        }

        #dashboardView .reading-unit {
            font-size: 14px;
            font-weight: 400;
            opacity: 0.7;
        }

        #dashboardView .reading-trend {
            height: 40px;
            margin-top: 8px;
        }

        /* Quality Badge */
        .quality-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: var(--font-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
        }

        .quality-badge.excellent { background: #2ecc71; color: white; }
        .quality-badge.good { background: #27ae60; color: white; }
        .quality-badge.moderate { background: #f39c12; color: white; }
        .quality-badge.poor { background: #e67e22; color: white; }
        .quality-badge.unhealthy { background: #e74c3c; color: white; }
        .quality-badge.hazardous { background: #c0392b; color: white; }

        /* Card Footer - Scoped to dashboard */
        #dashboardView .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            font-size: var(--font-base);
        }

        #dashboardView .device-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            padding: 12px 0;
            font-size: 13px;
        }

        #dashboardView .device-meta .meta-item {
            color: var(--text-secondary);
        }

        #dashboardView .device-meta .meta-item strong {
            color: var(--text-primary);
        }

        #dashboardView .sensor-card.inactive {
            opacity: 0.7;
            border-color: var(--border-color);
        }

        #dashboardView .sensor-card.inactive .card-header h3 {
            color: var(--text-secondary);
        }

        #dashboardView .last-update.stale {
            color: var(--text-secondary);
        }

        #dashboardView .calibration-status {
            color: var(--text-secondary);
        }

        #dashboardView .calibration-status.calibrated {
            color: #2ecc71;
            font-weight: 600;
        }

        #dashboardView .last-update {
            color: var(--text-secondary);
        }

        /* Regional View */
        .regional-header {
            margin-bottom: 24px;
        }

        .regional-header h2 {
            font-size: 24px;
            color: var(--text-primary);
            margin: 0 0 8px 0;
        }

        .regional-header p {
            color: var(--text-secondary);
            margin: 0;
        }

        /* ============= NEW DASHBOARD LAYOUT ============= */

        /* Astronomy Bar */
        .astronomy-bar {
            display: flex;
            align-items: center;
            gap: 24px;
            padding: 10px 24px;
            background: rgba(30, 41, 59, 0.6);
            font-size: 13px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .astronomy-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .astronomy-item.sun-rise { color: #fbbf24; }
        .astronomy-item.sun-set { color: #fb923c; }
        .astronomy-item.daylight { color: #64748b; }
        .astronomy-item.moon { color: #e2e8f0; }
        .astronomy-separator { color: #64748b; }

        /* Photography times */
        .astronomy-item.photo-times {
            gap: 8px;
        }

        .photo-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .photo-time {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 500;
        }

        .photo-time.golden {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .photo-time.blue {
            background: rgba(99, 102, 241, 0.15);
            color: #818cf8;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .photo-time.now {
            animation: photoNow 2s ease-in-out infinite;
        }

        .photo-time.passed {
            opacity: 0.4;
        }

        @keyframes photoNow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .sun-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        /* Contextual Alerts Bar */
        .contextual-alerts-bar {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(239, 68, 68, 0.08) 100%);
            border-bottom: 1px solid rgba(251, 191, 36, 0.2);
            padding: 10px 24px;
            overflow-x: auto;
        }

        .alerts-scroll {
            display: flex;
            gap: 12px;
            min-height: 40px;
            align-items: center;
        }

        .alert-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            white-space: nowrap;
            flex-shrink: 0;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .alert-chip:hover {
            background: rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .alert-chip.info {
            border-left: 3px solid #3b82f6;
        }

        .alert-chip.warning {
            border-left: 3px solid #f59e0b;
        }

        .alert-chip.alert {
            border-left: 3px solid #ef4444;
        }

        .alert-chip.success {
            border-left: 3px solid #22c55e;
        }

        .alert-chip-icon {
            font-size: 16px;
        }

        .alert-chip-content {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }

        .alert-chip-title {
            font-size: 12px;
            font-weight: 600;
            color: #f8fafc;
        }

        .alert-chip-action {
            font-size: 11px;
            color: #94a3b8;
        }

        .alert-dismiss {
            background: none;
            border: none;
            color: #64748b;
            font-size: 16px;
            cursor: pointer;
            padding: 0 4px;
            margin-left: 4px;
        }

        .alert-dismiss:hover {
            color: #f8fafc;
        }

        /* Weather Summary Hero Section */
        .weather-hero {
            display: flex;
            align-items: stretch;
            gap: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            transition: background 2s ease-in-out;
            position: relative;
            overflow: visible;
        }

        /* Temperature-responsive ambient gradients */
        .weather-hero[data-temp-zone="freezing"] {
            background: linear-gradient(135deg, #1e3a5f 0%, #0c4a6e 50%, #164e63 100%);
        }
        .weather-hero[data-temp-zone="cold"] {
            background: linear-gradient(135deg, #1e3a5f 0%, #155e75 50%, #1e293b 100%);
        }
        .weather-hero[data-temp-zone="cool"] {
            background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%);
        }
        .weather-hero[data-temp-zone="mild"] {
            background: linear-gradient(135deg, #1e3a5f 0%, #1e293b 100%);
        }
        .weather-hero[data-temp-zone="warm"] {
            background: linear-gradient(135deg, #422006 0%, #1e293b 60%, #1e3a5f 100%);
        }
        .weather-hero[data-temp-zone="hot"] {
            background: linear-gradient(135deg, #7c2d12 0%, #422006 40%, #1e293b 100%);
        }
        .weather-hero[data-temp-zone="extreme"] {
            background: linear-gradient(135deg, #991b1b 0%, #7c2d12 30%, #422006 60%, #1e293b 100%);
        }

        /* Ambient glow overlay for temperature extremes */
        .weather-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 2s ease-in-out;
            pointer-events: none;
            z-index: 0;
        }
        .weather-hero[data-temp-zone="hot"]::before,
        .weather-hero[data-temp-zone="extreme"]::before {
            background: radial-gradient(ellipse at 30% 50%, rgba(251, 146, 60, 0.15) 0%, transparent 60%);
            opacity: 1;
        }
        .weather-hero[data-temp-zone="freezing"]::before {
            background: radial-gradient(ellipse at 70% 50%, rgba(56, 189, 248, 0.1) 0%, transparent 60%);
            opacity: 1;
        }

        /* Ensure hero content stays above the overlay */
        .weather-hero > * {
            position: relative;
            z-index: 1;
        }

        /* Ambient fog/mist canvas */
        .hero-ambient-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .weather-hero[data-humidity-level="high"] .hero-ambient-canvas,
        .weather-hero[data-humidity-level="very-high"] .hero-ambient-canvas {
            opacity: 1;
        }

        @media (prefers-reduced-motion: reduce) {
            .hero-ambient-canvas {
                display: none;
            }
        }

        /* Clear sky / sunny effect */
        .weather-hero[data-weather="clear"]::after,
        .weather-hero[data-weather="sunny"]::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 80%;
            height: 200%;
            background: radial-gradient(
                ellipse at center,
                rgba(251, 191, 36, 0.12) 0%,
                rgba(251, 191, 36, 0.06) 30%,
                transparent 60%
            );
            pointer-events: none;
            z-index: 0;
            animation: sunGlow 8s ease-in-out infinite;
        }

        /* Golden hour - warmer, more intense glow */
        .weather-hero[data-weather="golden-hour"]::after {
            content: '';
            position: absolute;
            top: -30%;
            right: -10%;
            width: 70%;
            height: 160%;
            background: radial-gradient(
                ellipse at center,
                rgba(251, 146, 60, 0.18) 0%,
                rgba(251, 191, 36, 0.10) 35%,
                transparent 65%
            );
            pointer-events: none;
            z-index: 0;
            animation: goldenGlow 6s ease-in-out infinite;
        }

        /* Light rays overlay */
        .weather-hero[data-weather="clear"] .hero-sun-rays,
        .weather-hero[data-weather="sunny"] .hero-sun-rays,
        .weather-hero[data-weather="golden-hour"] .hero-sun-rays {
            opacity: 1;
        }

        .hero-sun-rays {
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            overflow: hidden;
        }

        .hero-sun-rays::before {
            content: '';
            position: absolute;
            top: -20%;
            right: -30%;
            width: 100%;
            height: 140%;
            background:
                linear-gradient(215deg, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                linear-gradient(225deg, rgba(255, 255, 255, 0.05) 0%, transparent 40%),
                linear-gradient(235deg, rgba(255, 255, 255, 0.03) 0%, transparent 35%);
            animation: rayShimmer 12s ease-in-out infinite;
        }

        @keyframes sunGlow {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        @keyframes goldenGlow {
            0%, 100% { opacity: 0.85; transform: scale(1) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.08) rotate(2deg); }
        }

        @keyframes rayShimmer {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        @media (prefers-reduced-motion: reduce) {
            .weather-hero[data-weather="clear"]::after,
            .weather-hero[data-weather="sunny"]::after,
            .weather-hero[data-weather="golden-hour"]::after,
            .hero-sun-rays::before {
                animation: none !important;
            }
        }

        /* Light mode sunny effect - more subtle */
        body:not(.dark-mode) .weather-hero[data-weather="clear"]::after,
        body:not(.dark-mode) .weather-hero[data-weather="sunny"]::after {
            background: radial-gradient(
                ellipse at center,
                rgba(251, 191, 36, 0.08) 0%,
                rgba(251, 191, 36, 0.04) 30%,
                transparent 60%
            );
        }

        body:not(.dark-mode) .weather-hero[data-weather="golden-hour"]::after {
            background: radial-gradient(
                ellipse at center,
                rgba(251, 146, 60, 0.12) 0%,
                rgba(251, 191, 36, 0.06) 35%,
                transparent 65%
            );
        }

        body:not(.dark-mode) .hero-sun-rays::before {
            background:
                linear-gradient(215deg, rgba(251, 191, 36, 0.06) 0%, transparent 50%),
                linear-gradient(225deg, rgba(251, 191, 36, 0.04) 0%, transparent 40%),
                linear-gradient(235deg, rgba(251, 191, 36, 0.02) 0%, transparent 35%);
        }

        /* Hero Location Selector (far left) */
        .hero-location {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 12px 16px;
            min-width: 100px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            gap: 8px;
            overflow: visible;
            z-index: 10;
        }

        /* Hero Swarm Toggle Button */
        .hero-swarm-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: rgba(100, 116, 139, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.4);
            border-radius: 16px;
            color: #94a3b8;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            align-self: flex-start;
        }

        .hero-swarm-toggle:hover {
            background: rgba(100, 116, 139, 0.4);
            border-color: rgba(100, 116, 139, 0.6);
        }

        .hero-swarm-toggle.active {
            background: rgba(251, 191, 36, 0.25);
            border-color: rgba(251, 191, 36, 0.5);
            color: #fbbf24;
        }

        .hero-swarm-toggle.active:hover {
            background: rgba(251, 191, 36, 0.35);
        }

        .hero-swarm-toggle.active .broadcast-icon {
            animation: broadcastPulse 2s ease-in-out infinite;
        }

        @keyframes broadcastPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .hero-swarm-toggle .broadcast-icon {
            flex-shrink: 0;
        }

        .hero-swarm-toggle .swarm-toggle-count {
            font-family: system-ui, -apple-system, sans-serif;
            font-variant-numeric: tabular-nums;
        }

        .hero-swarm-toggle.hidden {
            display: none;
        }

        .location-selector {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 8px 12px;
            color: #f8fafc;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .location-selector:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.25);
        }

        .location-name {
            white-space: nowrap;
        }

        .location-dropdown-icon {
            font-size: 12px;
            opacity: 0.7;
        }

        .location-subtitle {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 4px;
            padding-left: 2px;
        }

        .location-row {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .location-settings-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 6px;
            padding: 6px 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            line-height: 1;
        }

        .location-settings-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        /* Location Dropdown */
        .location-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            min-width: 200px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-8px);
            transition: all 0.2s ease;
        }

        .location-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .location-row {
            position: relative;
        }

        .location-dropdown-list {
            max-height: 240px;
            overflow-y: auto;
            padding: 4px 0;
        }

        .location-dropdown-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            color: var(--text-primary);
            font-size: 14px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .location-dropdown-item:hover {
            background: var(--bg-tertiary);
        }

        .location-dropdown-item.active {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-color);
        }

        .location-dropdown-item.active::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--accent-color);
            border-radius: 50%;
            margin-right: 8px;
        }

        .location-item-name {
            flex: 1;
        }

        .location-delete-btn {
            opacity: 0;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 16px;
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.15s;
        }

        .location-dropdown-item:hover .location-delete-btn {
            opacity: 0.6;
        }

        .location-delete-btn:hover {
            opacity: 1 !important;
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .location-dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 4px 0;
        }

        .location-dropdown-action {
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            padding: 10px 12px;
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 14px;
            cursor: pointer;
            transition: background 0.15s;
        }

        .location-dropdown-action:hover {
            background: var(--bg-tertiary);
        }

        .location-dropdown-action.secondary {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .location-dropdown-action.secondary:hover {
            color: var(--text-primary);
        }

        .dropdown-action-icon {
            font-size: 16px;
            font-weight: 600;
        }

        /* Add Location Modal */
        .add-location-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .add-location-modal.open {
            opacity: 1;
            visibility: visible;
        }

        .add-location-dialog {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 24px;
            width: 100%;
            max-width: 360px;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
            transform: scale(0.95);
            transition: transform 0.2s;
        }

        .add-location-modal.open .add-location-dialog {
            transform: scale(1);
        }

        .add-location-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .add-location-input {
            width: 100%;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 16px;
        }

        .add-location-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .add-location-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .add-location-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-location-btn.cancel {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .add-location-btn.cancel:hover {
            background: var(--bg-secondary);
            border-color: var(--text-muted);
        }

        .add-location-btn.confirm {
            background: var(--accent-color);
            border: none;
            color: white;
        }

        .add-location-btn.confirm:hover {
            filter: brightness(1.1);
        }

        /* Hero Time/Date (far right) */
        .hero-datetime {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            padding: 12px 16px;
            min-width: 80px;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hero-time {
            font-size: 24px;
            font-weight: 700;
            color: #f8fafc;
            line-height: 1.1;
        }

        .hero-date {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 2px;
        }

        /* Side cards - horizontal layout toward edges */
        .weather-side-cards {
            display: flex;
            flex-direction: row;
            align-items: stretch;
            flex: 1;
            min-width: 0;
            gap: 8px;
        }

        #weatherHistoryCards {
            justify-content: flex-start;
            padding-left: 12px;
        }

        #weatherForecastCards {
            justify-content: flex-end;
            padding-right: 12px;
        }

        .weather-mini-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 12px 18px;
            text-align: center;
            min-width: 90px;
            position: relative;
        }

        /* Vertical dividers between cards */
        #weatherHistoryCards .weather-mini-card:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        #weatherForecastCards .weather-mini-card:not(:first-child)::before {
            content: '';
            position: absolute;
            left: 0;
            top: 20%;
            height: 60%;
            width: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .mini-card-icon {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mini-card-icon svg {
            width: 100%;
            height: 100%;
        }

        .mini-card-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
        }

        .mini-card-label {
            font-size: 10px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .mini-card-temp {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            font-size: 18px;
            font-weight: 600;
            color: #f8fafc;
        }

        .mini-card-diff {
            font-size: 11px;
            font-weight: 500;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .mini-card-diff.warmer {
            color: #f97316;
            background: rgba(249, 115, 22, 0.2);
        }

        .mini-card-diff.cooler {
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.2);
        }

        .mini-card-diff.same {
            color: #94a3b8;
            background: rgba(148, 163, 184, 0.2);
        }

        .mini-card-detail {
            font-size: 10px;
            color: #94a3b8;
        }

        .weather-center {
            flex: 0 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 16px 24px;
            text-align: center;
            min-width: 200px;
        }

        .weather-icon-main {
            width: 100px;
            height: 100px;
            margin-bottom: 8px;
        }

        .weather-icon-main svg {
            width: 100%;
            height: 100%;
        }

        .weather-condition {
            font-size: 22px;
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 8px;
        }

        .weather-quick-stats {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 8px;
        }

        .weather-stat {
            display: flex;
            flex-direction: column;
            gap: 2px;
            align-items: center;
        }

        .weather-stat-label {
            font-size: 9px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .weather-stat-value {
            font-size: 14px;
            color: #f8fafc;
            font-weight: 500;
        }

        .forecast-icon {
            width: 32px;
            height: 32px;
        }

        .forecast-icon svg {
            width: 100%;
            height: 100%;
        }

        .forecast-info {
            display: flex;
            flex-direction: column;
        }

        .forecast-time {
            font-size: 10px;
            color: #64748b;
        }

        .forecast-text {
            font-size: 12px;
            color: #e2e8f0;
        }

        .pressure-trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 500;
        }

        .pressure-trend-indicator.rising {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .pressure-trend-indicator.falling {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .pressure-trend-indicator.steady {
            background: rgba(100, 116, 139, 0.15);
            color: #94a3b8;
        }

        .pressure-trend-indicator.storm-warning {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
        }

        /* Insight Strip - Alerts left, time buttons right */
        .insight-strip {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-top: 24px;
            padding: 8px 24px;
            background: #0f172a;
            min-height: 44px;
            border-bottom: 1px solid #334155;
        }

        .insight-strip-left {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            flex: 1;
        }

        .insight-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            cursor: default;
            animation: slideInRight 0.4s ease-out;
            transition: transform 0.2s ease, opacity 0.2s ease;
        }

        .insight-chip:hover {
            transform: scale(1.02);
        }

        .insight-chip.dismissing {
            animation: slideOutRight 0.3s ease-out forwards;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(-20px);
            }
        }

        .insight-chip .insight-icon {
            font-size: 16px;
            line-height: 1;
        }

        .insight-chip .insight-text {
            color: inherit;
        }

        /* Insight severity levels */
        .insight-chip.info {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .insight-chip.advice {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .insight-chip.warning {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .insight-chip.critical {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
            animation: slideInRight 0.4s ease-out, pulse 2s ease-in-out infinite;
        }

        /* Photography tips - warm amber/orange tone */
        .insight-chip.photo {
            background: rgba(251, 146, 60, 0.12);
            color: #fb923c;
            border: 1px solid rgba(251, 146, 60, 0.25);
        }

        .insight-chip.photo .insight-icon {
            font-family: system-ui, sans-serif;
        }

        /* Success/celebration - green with subtle glow */
        .insight-chip.success {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
            box-shadow: 0 0 12px rgba(34, 197, 94, 0.2);
        }

        .insight-chip.success .insight-icon {
            font-family: system-ui, sans-serif;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            50% { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0); }
        }

        @media (prefers-reduced-motion: reduce) {
            .insight-chip {
                animation: none !important;
            }
            .insight-chip.critical {
                animation: none !important;
            }
        }

        /* Main Metrics Row - 3 cards */
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            padding: 20px 24px;
            background: #0f172a;
        }

        .metric-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 1.5s ease;
            position: relative;
            min-width: 0; /* Allow grid item to shrink below content size */
            overflow: visible;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        /* Temperature card - warm/cool ambient background */
        .metric-card[data-metric="temperature"][data-temp-zone="freezing"] {
            background: linear-gradient(135deg, #1e293b 0%, #164e63 100%);
        }
        .metric-card[data-metric="temperature"][data-temp-zone="cold"] {
            background: linear-gradient(135deg, #1e293b 0%, #155e75 100%);
        }
        .metric-card[data-metric="temperature"][data-temp-zone="warm"] {
            background: linear-gradient(135deg, #1e293b 0%, #78350f 100%);
        }
        .metric-card[data-metric="temperature"][data-temp-zone="hot"] {
            background: linear-gradient(135deg, #1e293b 0%, #9a3412 100%);
        }
        .metric-card[data-metric="temperature"][data-temp-zone="extreme"] {
            background: linear-gradient(135deg, #1e293b 0%, #991b1b 100%);
        }

        /* Humidity card - misty blue when high */
        .metric-card[data-metric="humidity"][data-humidity-level="high"] {
            background: linear-gradient(135deg, #1e293b 0%, #0e4a5c 100%);
        }
        .metric-card[data-metric="humidity"][data-humidity-level="very-high"] {
            background: linear-gradient(135deg, #1e293b 0%, #0c4a6e 100%);
        }

        /* Condensation effect on humidity card */
        .metric-card[data-metric="humidity"][data-humidity-level="high"]::after,
        .metric-card[data-metric="humidity"][data-humidity-level="very-high"]::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 12px;
            pointer-events: none;
            opacity: 0.4;
            background-image:
                radial-gradient(circle at 15% 20%, rgba(125, 211, 252, 0.6) 0%, transparent 3px),
                radial-gradient(circle at 85% 15%, rgba(125, 211, 252, 0.5) 0%, transparent 2px),
                radial-gradient(circle at 25% 80%, rgba(125, 211, 252, 0.4) 0%, transparent 2.5px),
                radial-gradient(circle at 75% 75%, rgba(125, 211, 252, 0.5) 0%, transparent 2px),
                radial-gradient(circle at 10% 50%, rgba(125, 211, 252, 0.3) 0%, transparent 2px),
                radial-gradient(circle at 90% 45%, rgba(125, 211, 252, 0.4) 0%, transparent 1.5px),
                radial-gradient(circle at 5% 90%, rgba(125, 211, 252, 0.5) 0%, transparent 2px),
                radial-gradient(circle at 95% 85%, rgba(125, 211, 252, 0.4) 0%, transparent 2px);
            animation: condenseAppear 3s ease-in-out infinite alternate;
        }

        .metric-card[data-metric="humidity"][data-humidity-level="very-high"]::after {
            opacity: 0.6;
            background-image:
                radial-gradient(circle at 15% 20%, rgba(125, 211, 252, 0.7) 0%, transparent 4px),
                radial-gradient(circle at 85% 15%, rgba(125, 211, 252, 0.6) 0%, transparent 3px),
                radial-gradient(circle at 25% 80%, rgba(125, 211, 252, 0.5) 0%, transparent 3.5px),
                radial-gradient(circle at 75% 75%, rgba(125, 211, 252, 0.6) 0%, transparent 3px),
                radial-gradient(circle at 10% 50%, rgba(125, 211, 252, 0.4) 0%, transparent 2.5px),
                radial-gradient(circle at 90% 45%, rgba(125, 211, 252, 0.5) 0%, transparent 2px),
                radial-gradient(circle at 5% 90%, rgba(125, 211, 252, 0.6) 0%, transparent 3px),
                radial-gradient(circle at 95% 85%, rgba(125, 211, 252, 0.5) 0%, transparent 2.5px),
                radial-gradient(circle at 50% 10%, rgba(125, 211, 252, 0.4) 0%, transparent 2px),
                radial-gradient(circle at 40% 95%, rgba(125, 211, 252, 0.5) 0%, transparent 2.5px);
        }

        @keyframes condenseAppear {
            0% { opacity: 0.3; transform: scale(0.98); }
            100% { opacity: 0.6; transform: scale(1); }
        }

        @media (prefers-reduced-motion: reduce) {
            .metric-card[data-metric="humidity"]::after {
                animation: none !important;
            }
        }

        /* Pressure card - subtle glow when changing */
        .metric-card[data-metric="pressure"][data-pressure-trend="rising"] {
            background: linear-gradient(135deg, #1e293b 0%, #1e3a5f 100%);
        }
        .metric-card[data-metric="pressure"][data-pressure-trend="falling"] {
            background: linear-gradient(135deg, #1e293b 0%, #3f3f46 100%);
        }
        .metric-card[data-metric="pressure"][data-pressure-trend="storm"] {
            background: linear-gradient(135deg, #1e293b 0%, #44403c 100%);
        }

        .metric-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .metric-card-title {
            font-size: 13px;
            color: #94a3b8;
        }

        /* Sensor Quality Badge */
        .sensor-quality-badge-container {
            display: inline-flex;
            align-items: center;
            margin-left: 6px;
            cursor: default;
            position: relative;
        }

        .sensor-quality-badge {
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
            transition: transform 0.2s ease;
        }

        .sensor-quality-badge:hover {
            transform: scale(1.15);
        }

        /* Broadcast badge - radiating rings */
        .broadcast-badge {
            overflow: visible;
        }

        .broadcast-badge .broadcast-ring {
            transform-origin: center;
        }

        /* Gold tier - active pulsing animation */
        .broadcast-badge.tier-gold .broadcast-ring.gold-pulse,
        .broadcast-badge.tier-platinum .broadcast-ring.gold-pulse {
            animation: goldBroadcast 2s ease-in-out infinite;
        }

        @keyframes goldBroadcast {
            0%, 100% {
                opacity: 0.4;
                transform: scale(0.95);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
        }

        /* Gold shimmer effect on center circle */
        .broadcast-badge.tier-gold circle,
        .broadcast-badge.tier-platinum circle {
            animation: goldShimmer 3s ease-in-out infinite;
        }

        @keyframes goldShimmer {
            0%, 100% {
                filter: brightness(1);
            }
            50% {
                filter: brightness(1.3);
            }
        }

        /* Silver tier - subtle pulse */
        .broadcast-badge.tier-silver .broadcast-ring.silver-pulse {
            animation: silverBroadcast 3s ease-in-out infinite;
        }

        @keyframes silverBroadcast {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* Bronze tier - static, no animation */
        .broadcast-badge.tier-bronze .broadcast-ring {
            opacity: 0.4;
        }

        /* Unknown tier - very subtle */
        .broadcast-badge.tier-unknown .broadcast-ring {
            opacity: 0.2;
        }

        /* Reduce motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            .broadcast-badge .broadcast-ring,
            .broadcast-badge circle {
                animation: none !important;
            }
        }

        /* Badge tooltip - appears above the badge */
        .sensor-quality-badge-container[data-tooltip]::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            padding: 6px 10px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 6px;
            font-size: 12px;
            color: #e2e8f0;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s ease;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .sensor-quality-badge-container:hover[data-tooltip]::after {
            opacity: 1;
        }

        /* Swarm badge with icon */
        .swarm-badge {
            /* Badge itself stays the same */
        }

        /* Swarm icon label (emoji before badge) */
        .swarm-icon-label {
            font-size: 11px;
            margin-right: 2px;
            line-height: 1;
            vertical-align: middle;
            cursor: default;
        }

        /* Swarm status colors for icon glow */
        .sensor-quality-badge-container[data-tooltip*="Super Swarm"] .swarm-icon-label {
            filter: drop-shadow(0 0 3px rgba(234, 179, 8, 0.6));
        }

        .sensor-quality-badge-container[data-tooltip*="Peer Verified"] .swarm-icon-label {
            filter: drop-shadow(0 0 3px rgba(59, 130, 246, 0.5));
        }

        /* Swarm Prompt Banner - inline in insight strip */
        .swarm-prompt {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            margin: 0;
            border-radius: 6px;
            font-size: 11px;
            line-height: 1.2;
        }

        .swarm-prompt-icon {
            font-size: 14px;
            flex-shrink: 0;
        }

        .swarm-prompt-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .swarm-prompt-text strong {
            font-weight: 600;
        }

        .swarm-prompt-link {
            font-size: 11px;
            color: inherit;
            opacity: 0.8;
            text-decoration: underline;
            flex-shrink: 0;
            margin-left: 8px;
        }

        .swarm-prompt-link:hover {
            opacity: 1;
        }

        /* Swarm prompt variants */
        .swarm-prompt-default {
            background: rgba(100, 116, 139, 0.1);
            border: 1px solid rgba(100, 116, 139, 0.2);
            color: var(--text-secondary);
        }

        .swarm-prompt-warning {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: #b45309;
        }

        .swarm-prompt-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #1d4ed8;
        }

        .swarm-prompt-success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #15803d;
        }

        /* Dark mode adjustments */
        @media (prefers-color-scheme: dark) {
            .swarm-prompt-warning {
                color: #fbbf24;
            }
            .swarm-prompt-info {
                color: #60a5fa;
            }
            .swarm-prompt-success {
                color: #4ade80;
            }
        }

        .metric-card-comparison {
            font-size: 10px;
            color: #64748b;
            text-align: right;
        }

        .metric-card-comparison .diff {
            font-size: 11px;
            margin-left: 4px;
        }

        .metric-card-comparison .diff.positive { color: #22c55e; }
        .metric-card-comparison .diff.negative { color: #ef4444; }
        .metric-card-comparison .diff.neutral { color: #64748b; }

        .metric-card-value {
            font-size: 32px;
            font-weight: 600;
            color: #f8fafc;
            margin-bottom: 4px;
            transition: color 0.5s ease;
        }

        /* Value update animation */
        .metric-card-value.updating {
            animation: valueUpdate 0.4s ease-out;
        }

        @keyframes valueUpdate {
            0% { opacity: 0.6; transform: translateY(3px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Temperature-responsive value colors */
        .metric-card-value[data-temp-zone="freezing"] { color: #7dd3fc; }
        .metric-card-value[data-temp-zone="cold"] { color: #a5f3fc; }
        .metric-card-value[data-temp-zone="cool"] { color: #f8fafc; }
        .metric-card-value[data-temp-zone="mild"] { color: #f8fafc; }
        .metric-card-value[data-temp-zone="warm"] { color: #fde68a; }
        .metric-card-value[data-temp-zone="hot"] { color: #fdba74; }
        .metric-card-value[data-temp-zone="extreme"] { color: #fca5a5; }

        .metric-card-secondary {
            font-size: 11px;
            color: #64748b;
            margin-bottom: 12px;
            transition: color 0.3s ease;
        }

        /* Swarm toggle button */
        .swarm-toggle {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(100, 116, 139, 0.2);
            border: 1px solid rgba(100, 116, 139, 0.3);
            color: #94a3b8;
            margin-left: auto;
            margin-right: 12px;
        }

        .swarm-toggle:hover {
            background: rgba(100, 116, 139, 0.3);
            border-color: rgba(100, 116, 139, 0.5);
        }

        .swarm-toggle.active {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.4);
            color: #fbbf24;
        }

        .swarm-toggle.active:hover {
            background: rgba(251, 191, 36, 0.3);
        }

        .swarm-toggle-icon {
            font-size: 11px;
        }

        .swarm-toggle-label {
            font-weight: 500;
        }

        /* Hide toggle when no swarm available */
        .swarm-toggle.hidden {
            display: none;
        }

        /* Swarm value as secondary display */
        .metric-card-swarm-value {
            font-size: 11px;
            color: #64748b;
            margin-top: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .metric-card-swarm-value .swarm-label {
            color: #94a3b8;
        }

        .metric-card-swarm-value .swarm-reading {
            color: #fbbf24;
            font-weight: 500;
        }

        .metric-card-swarm-value.hidden {
            display: none;
        }

        /* When showing swarm as primary, my sensor value becomes secondary */
        .metric-card-my-value {
            font-size: 11px;
            color: #64748b;
            margin-top: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .metric-card-my-value .my-label {
            color: #94a3b8;
        }

        .metric-card-my-value .my-reading {
            color: #3b82f6;
            font-weight: 500;
        }

        .metric-card-my-value.hidden {
            display: none;
        }

        /* Comparison badge pulse on significant change */
        .metric-card-comparison .diff.pulse {
            animation: badgePulse 0.6s ease-out;
        }

        @keyframes badgePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* Accessibility: Reduce motion for users who prefer it */
        @media (prefers-reduced-motion: reduce) {
            .weather-hero,
            .weather-hero::before,
            .metric-card-value,
            .metric-card-secondary {
                transition: none !important;
            }

            .metric-card-value.updating {
                animation: none !important;
            }

            .metric-card-comparison .diff.pulse {
                animation: none !important;
            }
        }

        /* Sparkline in metric card - taller with axis labels */
        .metric-card-sparkline {
            height: 70px;
            margin-top: 12px;
            position: relative;
            display: flex;
            padding-bottom: 16px;
            min-width: 0; /* Allow flex container to shrink */
        }

        .metric-card-sparkline .y-axis {
            width: 32px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 9px;
            color: #64748b;
            text-align: right;
            padding-right: 6px;
            flex-shrink: 0;
        }

        .metric-card-sparkline .chart-area {
            flex: 1;
            position: relative;
            min-width: 0;
        }

        .metric-card-sparkline .chart-area canvas {
            width: 100%;
            height: 100%;
        }

        .metric-card-sparkline .x-axis {
            position: absolute;
            bottom: 0;
            left: 32px;
            right: 0;
            display: flex;
            justify-content: space-between;
            font-size: 8px;
            color: #475569;
        }

        .sparkline-end-dot {
            display: none; /* Hide the dot, chart shows current value */
        }

        /* Today's range bar under metric value */
        .metric-card-range {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 6px;
            font-size: 10px;
        }

        .metric-card-range .range-bar {
            flex: 1;
            height: 4px;
            background: #334155;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }

        .metric-card-range .range-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(to right, #3b82f6, #8b5cf6);
            border-radius: 2px;
        }

        .metric-card-range .range-marker {
            position: absolute;
            top: -2px;
            width: 8px;
            height: 8px;
            background: #f8fafc;
            border: 2px solid #f97316;
            border-radius: 50%;
            transform: translateX(-50%);
        }

        .metric-card-range .range-low { color: #3b82f6; }
        .metric-card-range .range-high { color: #f97316; }

        /* Chart overlay icons - positioned top-right below comparison */
        .chart-overlay-icon {
            position: absolute;
            right: 0;
            top: 38px;
            pointer-events: none;
            z-index: 1;
        }

        .chart-overlay-icon svg {
            width: 40px;
            height: 40px;
            transition: transform 0.3s ease;
        }

        /* Micro-animations for metric icons */
        /* Temperature - gentle pulse when hot, slow pulse when cold */
        .metric-card[data-temp-zone="hot"] .chart-overlay-icon svg,
        .metric-card[data-temp-zone="extreme"] .chart-overlay-icon svg {
            animation: warmPulse 2s ease-in-out infinite;
        }

        .metric-card[data-temp-zone="freezing"] .chart-overlay-icon svg,
        .metric-card[data-temp-zone="cold"] .chart-overlay-icon svg {
            animation: coldPulse 3s ease-in-out infinite;
        }

        @keyframes warmPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.1); }
        }

        @keyframes coldPulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(0.97); filter: brightness(1.05); }
        }

        /* Humidity - gentle wobble when very high */
        .metric-card[data-humidity-level="very-high"] .chart-overlay-icon svg {
            animation: dropletWobble 2.5s ease-in-out infinite;
        }

        @keyframes dropletWobble {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(2deg); }
            75% { transform: rotate(-2deg); }
        }

        /* Pressure - subtle rotation when changing */
        .metric-card[data-pressure-trend="falling"] .chart-overlay-icon svg,
        .metric-card[data-pressure-trend="storm"] .chart-overlay-icon svg {
            animation: needleFall 3s ease-in-out infinite;
        }

        .metric-card[data-pressure-trend="rising"] .chart-overlay-icon svg {
            animation: needleRise 3s ease-in-out infinite;
        }

        @keyframes needleFall {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(-5deg); }
        }

        @keyframes needleRise {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(5deg); }
        }

        /* Hover effect for all icons */
        .metric-card:hover .chart-overlay-icon svg {
            transform: scale(1.1);
        }

        @media (prefers-reduced-motion: reduce) {
            .chart-overlay-icon svg {
                animation: none !important;
            }
        }

        /* Air quality card overlay - top right */
        .air-quality-card {
            position: relative;
        }

        .air-quality-card .chart-overlay-icon {
            right: 12px;
            top: 16px;
        }

        .air-quality-card .chart-overlay-icon svg {
            width: 28px;
            height: 28px;
        }

        /* Historical Trends Section */
        .trends-section {
            padding: 20px 24px;
            background: #0f172a;
        }

        .trends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .trends-title {
            font-size: 14px;
            font-weight: 600;
            color: #f8fafc;
        }

        .trends-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .trend-card {
            background: #1e293b;
            border-radius: 10px;
            padding: 14px;
        }

        .trend-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .trend-card-title {
            font-size: 12px;
            color: #94a3b8;
        }
        .trend-card-title .trend-timeframe {
            font-size: 10px;
            opacity: 0.7;
            margin-left: 4px;
        }

        .trend-card-value {
            font-size: 14px;
            font-weight: 600;
            color: #f8fafc;
        }

        .trend-chart-container {
            height: 90px;
            position: relative;
            display: flex;
        }

        .trend-chart-container .y-axis {
            width: 28px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 8px;
            color: #64748b;
            text-align: right;
            padding-right: 4px;
            flex-shrink: 0;
        }

        .trend-chart-container .chart-area {
            flex: 1;
            position: relative;
            padding-bottom: 14px;
        }

        .trend-chart-container canvas {
            width: 100%;
            height: 100%;
        }

        .trend-chart-container .x-axis {
            position: absolute;
            left: 28px;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: space-between;
            font-size: 7px;
            color: #475569;
        }

        @media (max-width: 1100px) {
            .trends-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 700px) {
            .trends-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Two-Column Dashboard Layout (Outdoor | Indoor) */
        .dashboard-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            padding: 20px 24px;
            background: #0f172a;
        }

        .dashboard-column {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .column-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 4px 8px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
            margin-bottom: 4px;
        }

        .column-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
            font-weight: 600;
            color: #e2e8f0;
        }

        .column-title .column-icon {
            font-size: 18px;
        }

        .column-title.outdoor .column-icon { color: #22c55e; }
        .column-title.indoor .column-icon { color: #3b82f6; }

        .column-badge {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .column-badge.good {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .column-badge.moderate {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .column-badge.no-data {
            background: rgba(100, 116, 139, 0.15);
            color: #64748b;
        }

        .column-content {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        /* Compact metric card for column layout */
        .column-metric-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 16px 18px;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
            border: 1px solid transparent;
        }

        .column-metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(148, 163, 184, 0.1);
        }

        .column-metric-card .card-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .column-metric-card .card-main {
            flex: 1;
        }

        .column-metric-card .card-label {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .column-metric-card .card-label .metric-icon {
            font-size: 14px;
        }

        .column-metric-card .card-value {
            font-size: 28px;
            font-weight: 600;
            color: #f8fafc;
            line-height: 1.1;
        }

        .column-metric-card .card-secondary {
            font-size: 11px;
            color: #64748b;
            margin-top: 2px;
        }

        .column-metric-card .card-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .column-metric-card .card-diff {
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .column-metric-card .card-diff.positive {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .column-metric-card .card-diff.negative {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .column-metric-card .card-diff.neutral {
            background: rgba(100, 116, 139, 0.1);
            color: #64748b;
        }

        .column-metric-card .card-range {
            font-size: 10px;
            color: #64748b;
        }

        .column-metric-card .card-sparkline {
            height: 40px;
            margin-top: 12px;
            position: relative;
        }

        .column-metric-card .card-sparkline canvas {
            width: 100%;
            height: 100%;
        }

        /* No Data State */
        .column-metric-card.no-data {
            opacity: 0.6;
            border: 1px dashed rgba(100, 116, 139, 0.3);
        }

        .column-metric-card.no-data .card-value {
            color: #64748b;
        }

        .column-metric-card .no-data-hint {
            font-size: 10px;
            color: #64748b;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .column-metric-card .no-data-hint .add-icon {
            color: #3b82f6;
        }

        /* Summary card at top of column */
        .column-summary-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 14px;
            padding: 18px 20px;
            border: 1px solid rgba(148, 163, 184, 0.08);
        }

        .column-summary-card.outdoor {
            border-left: 3px solid #22c55e;
        }

        .column-summary-card.indoor {
            border-left: 3px solid #3b82f6;
        }

        .summary-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .summary-value {
            font-size: 36px;
            font-weight: 600;
            color: #f8fafc;
        }

        .summary-badge {
            font-size: 13px;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        .summary-badge.good {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .summary-badge.moderate {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }

        .summary-badge.poor {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .summary-details {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: #94a3b8;
        }

        .summary-detail-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Mobile responsive */
        @media (max-width: 900px) {
            .dashboard-columns {
                grid-template-columns: 1fr;
                gap: 32px;
            }

            .column-header {
                padding-bottom: 12px;
            }
        }

        /* Air Quality Section */
        .air-quality-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
            padding: 20px 24px;
            background: #0f172a;
            margin-top: 16px;
        }

        /* Air Quality Sub-block */
        .air-quality-subblock {
            background: #0f172a;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: transform 0.15s ease, background 0.15s ease;
        }

        .air-quality-subblock:hover {
            background: #1a2744;
            transform: translateY(-1px);
        }

        .subblock-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .subblock-title {
            font-size: 13px;
            font-weight: 500;
            color: #94a3b8;
        }

        /* Legacy air-quality-card kept for compatibility */
        .air-quality-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 16px 20px;
            cursor: pointer;
            transition: transform 0.15s ease;
            min-width: 0; /* Allow grid item to shrink below content size */
            overflow: hidden;
        }

        .air-quality-card:hover {
            transform: translateY(-2px);
        }

        .air-quality-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .air-quality-header.outdoor { color: #22c55e; }
        .air-quality-header.indoor { color: #3b82f6; }

        .air-quality-header .header-icon {
            width: 24px;
            height: 24px;
            opacity: 0.7;
        }

        .air-quality-value {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        /* No margin when inside subblock header */
        .subblock-header .air-quality-value {
            margin-bottom: 0;
        }

        .air-quality-value .aqi {
            font-size: 22px;
            font-weight: 600;
            color: #f8fafc;
        }

        .subblock-header .air-quality-value .aqi {
            font-size: 18px;
        }

        .air-quality-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }

        .air-quality-badge .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .air-quality-badge.good { color: #22c55e; }
        .air-quality-badge.good .dot { background: #22c55e; }
        .air-quality-badge.moderate { color: #f59e0b; }
        .air-quality-badge.moderate .dot { background: #f59e0b; }
        .air-quality-badge.poor { color: #ef4444; }
        .air-quality-badge.poor .dot { background: #ef4444; }

        .air-quality-details {
            font-size: 12px;
            color: #94a3b8;
        }

        /* Per-room indoor air cards */
        .indoor-expandable {
            display: flex;
            flex-direction: column;
        }

        .indoor-rooms-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .indoor-rooms-container:empty {
            display: none;
        }

        .outdoor-sensors-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .outdoor-sensors-container:empty {
            display: none;
        }

        .outdoor-sensor-card {
            background: rgba(34, 197, 94, 0.08);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease, border-color 0.2s ease;
        }

        /* Dynamic coloring based on status */
        .outdoor-sensor-card.good {
            background: rgba(34, 197, 94, 0.08);
            border-color: rgba(34, 197, 94, 0.2);
        }
        .outdoor-sensor-card.good:hover {
            border-color: rgba(34, 197, 94, 0.4);
        }

        .outdoor-sensor-card.moderate {
            background: rgba(245, 158, 11, 0.08);
            border-color: rgba(245, 158, 11, 0.2);
        }
        .outdoor-sensor-card.moderate:hover {
            border-color: rgba(245, 158, 11, 0.4);
        }

        .outdoor-sensor-card.warning {
            background: rgba(249, 115, 22, 0.08);
            border-color: rgba(249, 115, 22, 0.2);
        }
        .outdoor-sensor-card.warning:hover {
            border-color: rgba(249, 115, 22, 0.4);
        }

        .outdoor-sensor-card.critical {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
        .outdoor-sensor-card.critical:hover {
            border-color: rgba(239, 68, 68, 0.5);
        }

        .outdoor-sensor-card.nodata {
            background: rgba(100, 116, 139, 0.08);
            border-color: rgba(100, 116, 139, 0.2);
        }
        .outdoor-sensor-card.nodata:hover {
            border-color: rgba(100, 116, 139, 0.4);
        }

        /* Stale outdoor sensor styling - grey out text */
        .outdoor-sensor-card.stale .sensor-name,
        .outdoor-sensor-card.stale .sensor-value {
            color: #64748b;
        }
        .outdoor-sensor-card.stale .sensor-value.pm25,
        .outdoor-sensor-card.stale .sensor-value.temp,
        .outdoor-sensor-card.stale .sensor-value.humidity {
            color: #64748b;
        }

        .outdoor-sensor-card.info {
            background: rgba(59, 130, 246, 0.08);
            border-color: rgba(59, 130, 246, 0.2);
        }
        .outdoor-sensor-card.info:hover {
            border-color: rgba(59, 130, 246, 0.4);
        }

        .outdoor-sensor-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .outdoor-sensor-card .sensor-header {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .outdoor-sensor-card .sensor-header .room-type-icon-wrapper {
            flex-shrink: 0;
        }

        .outdoor-sensor-card .sensor-name {
            font-size: 12px;
            font-weight: 600;
            color: #e2e8f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
        }

        .outdoor-sensor-card .sensor-header .sensor-count-badge {
            flex-shrink: 0;
        }

        .outdoor-sensor-card .sensor-header .sensor-status {
            margin-left: auto;
        }

        .outdoor-sensor-card .sensor-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        .outdoor-sensor-card .sensor-status.good { background: #22c55e; }
        .outdoor-sensor-card .sensor-status.moderate { background: #f59e0b; }
        .outdoor-sensor-card .sensor-status.warning { background: #f97316; }
        .outdoor-sensor-card .sensor-status.critical { background: #ef4444; }
        .outdoor-sensor-card .sensor-status.nodata { background: #64748b; }
        .outdoor-sensor-card .sensor-status.info { background: #3b82f6; }

        .outdoor-sensor-card .sensor-values {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .outdoor-sensor-card .sensor-value {
            font-size: 11px;
            color: #94a3b8;
        }

        .outdoor-sensor-card .sensor-value.pm25,
        .outdoor-sensor-card .sensor-value.pm { color: #22c55e; }
        .outdoor-sensor-card .sensor-value.temp { color: #f97316; }
        .outdoor-sensor-card .sensor-value.humidity { color: #06b6d4; }
        .outdoor-sensor-card .sensor-value.co2 { color: #a78bfa; }
        .outdoor-sensor-card .sensor-value.voc { color: #facc15; }

        /* Small inline metric icons for sensor cards */
        .metric-icon {
            width: 14px;
            height: 14px;
            vertical-align: middle;
            margin-right: 2px;
            display: inline-block;
        }
        .metric-icon.temp { color: #f97316; }
        .metric-icon.humidity { color: #06b6d4; }
        .metric-icon.pressure { color: #8b5cf6; }
        .metric-icon.co2 { color: #a78bfa; }
        .metric-icon.pm { color: #22c55e; }
        .metric-icon.voc { color: #facc15; }

        /* Icon tooltip wrapper */
        .icon-tooltip {
            display: inline-flex;
        }

        /* Global floating tooltip element (added by JS) */
        #iconTooltip {
            position: fixed;
            padding: 4px 8px;
            background: rgba(15, 23, 42, 0.95);
            color: #e2e8f0;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
            z-index: 100000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: opacity 0.1s ease;
        }
        #iconTooltip.visible {
            opacity: 1;
        }
        /* Light mode tooltip */
        body:not(.dark-mode) #iconTooltip {
            background: rgba(30, 41, 59, 0.95);
            color: #f1f5f9;
        }

        /* Align values with icons */
        .sensor-value, .room-card-row .value {
            display: inline-flex;
            align-items: center;
        }

        .outdoor-sensor-card .sensor-insight {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 11px;
        }

        .outdoor-sensor-card .sensor-insight .insight-icon {
            font-size: 12px;
        }

        .outdoor-sensor-card .sensor-insight .insight-text {
            color: #94a3b8;
        }

        .outdoor-sensor-card .sensor-insight.good .insight-text { color: #22c55e; }
        .outdoor-sensor-card .sensor-insight.moderate .insight-text { color: #f59e0b; }
        .outdoor-sensor-card .sensor-insight.warning .insight-text { color: #f97316; }
        .outdoor-sensor-card .sensor-insight.critical .insight-text { color: #ef4444; font-weight: 600; }
        .outdoor-sensor-card .sensor-insight.nodata .insight-text { color: #64748b; }
        .outdoor-sensor-card .sensor-insight.info .insight-text { color: #3b82f6; }

        .outdoor-sensor-card .sensor-updated {
            font-size: 10px;
            color: #64748b;
            margin-top: 4px;
        }

        /* Make outdoor card expandable like indoor */
        .air-quality-card.outdoor-expandable {
            display: flex;
            flex-direction: column;
            min-height: auto;
        }

        .air-quality-card.full-width {
            grid-column: 1 / -1;
        }

        .room-card {
            background: rgba(59, 130, 246, 0.08);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            padding: 10px 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            transition: background 0.2s ease, border-color 0.2s ease;
        }

        /* Dynamic coloring based on status */
        .room-card.good {
            background: rgba(34, 197, 94, 0.08);
            border-color: rgba(34, 197, 94, 0.2);
        }
        .room-card.good.clickable:hover {
            border-color: rgba(34, 197, 94, 0.4);
        }

        .room-card.moderate {
            background: rgba(245, 158, 11, 0.08);
            border-color: rgba(245, 158, 11, 0.2);
        }
        .room-card.moderate.clickable:hover {
            border-color: rgba(245, 158, 11, 0.4);
        }

        .room-card.warning {
            background: rgba(249, 115, 22, 0.08);
            border-color: rgba(249, 115, 22, 0.2);
        }
        .room-card.warning.clickable:hover {
            border-color: rgba(249, 115, 22, 0.4);
        }

        .room-card.critical {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }
        .room-card.critical.clickable:hover {
            border-color: rgba(239, 68, 68, 0.5);
        }

        .room-card.nodata {
            background: rgba(100, 116, 139, 0.08);
            border-color: rgba(100, 116, 139, 0.2);
        }
        .room-card.nodata.clickable:hover {
            border-color: rgba(100, 116, 139, 0.4);
        }

        /* Stale sensor styling - grey out text */
        .room-card.stale .room-card-name,
        .room-card.stale .room-card-row .value {
            color: #64748b;
        }
        .room-card.stale .room-card-row .temp,
        .room-card.stale .room-card-row .humidity,
        .room-card.stale .room-card-row .co2,
        .room-card.stale .room-card-row .pressure {
            color: #64748b;
        }

        .room-card.info {
            background: rgba(59, 130, 246, 0.08);
            border-color: rgba(59, 130, 246, 0.2);
        }
        .room-card.info.clickable:hover {
            border-color: rgba(59, 130, 246, 0.4);
        }

        .room-card-header {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .room-type-icon-wrapper {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .room-type-icon {
            width: 18px;
            height: 18px;
            color: #94a3b8;
        }

        .room-card:hover .room-type-icon {
            color: #cbd5e1;
        }

        .room-card-name {
            font-size: 12px;
            font-weight: 600;
            color: #e2e8f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
            min-width: 0;
        }

        .sensor-count-badge {
            flex-shrink: 0;
            font-size: 9px;
            padding: 2px 6px;
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            color: #60a5fa;
            font-weight: 500;
        }

        .room-card.stale .sensor-count-badge {
            background: rgba(100, 116, 139, 0.15);
            border-color: rgba(100, 116, 139, 0.3);
            color: #64748b;
        }

        .room-card-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .room-card-status.good { background: #22c55e; }
        .room-card-status.moderate { background: #f59e0b; }
        .room-card-status.warning { background: #f97316; }
        .room-card-status.critical { background: #ef4444; }
        .room-card-status.nodata { background: #64748b; }
        .room-card-status.info { background: #3b82f6; }

        .room-card-row {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: #94a3b8;
        }

        .room-card-row .value {
            color: #e2e8f0;
            font-weight: 500;
        }

        .room-card-row .temp { color: #f97316; }
        .room-card-row .humidity { color: #06b6d4; }
        .room-card-row .co2 { color: #a78bfa; }
        .room-card-row .pressure { color: #8b5cf6; }
        .room-card-row .pm { color: #22c55e; }
        .room-card-row .voc { color: #facc15; }

        .room-card.clickable {
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.2s ease, border-color 0.2s ease;
        }

        .room-card.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .room-card-insight {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 11px;
        }

        .room-card-insight .insight-icon {
            font-size: 12px;
        }

        .room-card-insight .insight-text {
            color: #94a3b8;
        }

        .room-card-insight.good .insight-text { color: #22c55e; }
        .room-card-insight.moderate .insight-text { color: #f59e0b; }
        .room-card-insight.warning .insight-text { color: #f97316; }
        .room-card-insight.critical .insight-text { color: #ef4444; font-weight: 600; }
        .room-card-insight.nodata .insight-text { color: #64748b; }
        .room-card-insight.info .insight-text { color: #3b82f6; }

        .room-card-lastseen {
            font-size: 10px;
            color: #64748b;
            margin-top: 4px;
        }

        .air-quality-sparkline {
            height: 20px;
            margin-top: 8px;
            opacity: 0.6;
            position: relative;
        }

        /* Time Navigation Buttons (now inside insight strip) */
        .time-nav-buttons {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .time-nav-btn {
            padding: 6px 14px;
            background: #334155;
            border: none;
            border-radius: 6px;
            color: #94a3b8;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .time-nav-btn:hover {
            background: #475569;
            color: #f8fafc;
        }

        .time-nav-btn.active {
            background: #3b82f6;
            color: #ffffff;
            font-weight: 500;
        }

        /* Contextual Message Bar */
        .contextual-message {
            margin: 16px 24px 20px;
            padding: 12px 16px;
            background: #1e3a5f;
            border-radius: 8px;
            font-size: 13px;
            color: #fbbf24;
            display: none;
        }

        .contextual-message.visible {
            display: block;
        }

        .contextual-message .hint-icon {
            margin-right: 6px;
        }

        /* Sparkline timeframe label */
        .sparkline-timeframe-label {
            text-align: right;
            font-size: 10px;
            color: #475569;
            padding: 4px 24px 0;
            background: #0f172a;
        }

        /* Dark mode already matches design, light mode adjustments */

        /* Weather Hero - Light Mode */
        body:not(.dark-mode) .weather-hero {
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
            border-bottom: 1px solid var(--border-color);
        }

        /* Temperature-responsive ambient gradients - Light Mode */
        body:not(.dark-mode) .weather-hero[data-temp-zone="freezing"] {
            background: linear-gradient(135deg, #cffafe 0%, #e0f2fe 50%, #f0f9ff 100%);
        }
        body:not(.dark-mode) .weather-hero[data-temp-zone="cold"] {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
        }
        body:not(.dark-mode) .weather-hero[data-temp-zone="cool"] {
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
        }
        body:not(.dark-mode) .weather-hero[data-temp-zone="mild"] {
            background: linear-gradient(135deg, #e0e7ff 0%, #f1f5f9 100%);
        }
        body:not(.dark-mode) .weather-hero[data-temp-zone="warm"] {
            background: linear-gradient(135deg, #fef3c7 0%, #fef9c3 40%, #f1f5f9 100%);
        }
        body:not(.dark-mode) .weather-hero[data-temp-zone="hot"] {
            background: linear-gradient(135deg, #fed7aa 0%, #fef3c7 50%, #f1f5f9 100%);
        }
        body:not(.dark-mode) .weather-hero[data-temp-zone="extreme"] {
            background: linear-gradient(135deg, #fecaca 0%, #fed7aa 40%, #fef3c7 70%, #f1f5f9 100%);
        }

        /* Ambient glow overlay - Light Mode */
        body:not(.dark-mode) .weather-hero[data-temp-zone="hot"]::before,
        body:not(.dark-mode) .weather-hero[data-temp-zone="extreme"]::before {
            background: radial-gradient(ellipse at 30% 50%, rgba(251, 146, 60, 0.08) 0%, transparent 60%);
        }
        body:not(.dark-mode) .weather-hero[data-temp-zone="freezing"]::before {
            background: radial-gradient(ellipse at 70% 50%, rgba(14, 165, 233, 0.08) 0%, transparent 60%);
        }

        /* Temperature value colors - Light Mode */
        body:not(.dark-mode) .metric-card-value[data-temp-zone="freezing"] { color: #0284c7; }
        body:not(.dark-mode) .metric-card-value[data-temp-zone="cold"] { color: #0891b2; }
        body:not(.dark-mode) .metric-card-value[data-temp-zone="warm"] { color: #d97706; }
        body:not(.dark-mode) .metric-card-value[data-temp-zone="hot"] { color: #ea580c; }
        body:not(.dark-mode) .metric-card-value[data-temp-zone="extreme"] { color: #dc2626; }

        /* Light mode card ambient backgrounds */
        body:not(.dark-mode) .metric-card[data-metric="temperature"][data-temp-zone="freezing"] {
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="temperature"][data-temp-zone="cold"] {
            background: linear-gradient(135deg, #f8fafc 0%, #ecfeff 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="temperature"][data-temp-zone="warm"] {
            background: linear-gradient(135deg, #f8fafc 0%, #fef3c7 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="temperature"][data-temp-zone="hot"] {
            background: linear-gradient(135deg, #f8fafc 0%, #fed7aa 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="temperature"][data-temp-zone="extreme"] {
            background: linear-gradient(135deg, #f8fafc 0%, #fecaca 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="humidity"][data-humidity-level="high"] {
            background: linear-gradient(135deg, #f8fafc 0%, #e0f2fe 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="humidity"][data-humidity-level="very-high"] {
            background: linear-gradient(135deg, #f8fafc 0%, #cffafe 100%);
        }

        /* Light mode condensation droplets */
        body:not(.dark-mode) .metric-card[data-metric="humidity"][data-humidity-level="high"]::after,
        body:not(.dark-mode) .metric-card[data-metric="humidity"][data-humidity-level="very-high"]::after {
            background-image:
                radial-gradient(circle at 15% 20%, rgba(14, 165, 233, 0.4) 0%, transparent 3px),
                radial-gradient(circle at 85% 15%, rgba(14, 165, 233, 0.35) 0%, transparent 2px),
                radial-gradient(circle at 25% 80%, rgba(14, 165, 233, 0.3) 0%, transparent 2.5px),
                radial-gradient(circle at 75% 75%, rgba(14, 165, 233, 0.35) 0%, transparent 2px),
                radial-gradient(circle at 10% 50%, rgba(14, 165, 233, 0.25) 0%, transparent 2px),
                radial-gradient(circle at 90% 45%, rgba(14, 165, 233, 0.3) 0%, transparent 1.5px),
                radial-gradient(circle at 5% 90%, rgba(14, 165, 233, 0.35) 0%, transparent 2px),
                radial-gradient(circle at 95% 85%, rgba(14, 165, 233, 0.3) 0%, transparent 2px);
        }
        body:not(.dark-mode) .metric-card[data-metric="pressure"][data-pressure-trend="rising"] {
            background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="pressure"][data-pressure-trend="falling"] {
            background: linear-gradient(135deg, #f8fafc 0%, #f5f5f4 100%);
        }
        body:not(.dark-mode) .metric-card[data-metric="pressure"][data-pressure-trend="storm"] {
            background: linear-gradient(135deg, #f8fafc 0%, #e7e5e4 100%);
        }

        body:not(.dark-mode) .hero-location {
            border-right: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .location-selector {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }

        body:not(.dark-mode) .location-selector:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
        }

        body:not(.dark-mode) .location-subtitle {
            color: var(--text-secondary);
        }

        body:not(.dark-mode) .hero-datetime {
            border-left: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .hero-time {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .hero-date {
            color: var(--text-secondary);
        }

        body:not(.dark-mode) .location-settings-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .location-settings-btn:hover {
            background: var(--bg-tertiary);
            border-color: var(--accent-color);
        }

        /* Location Dropdown - Light Mode */
        body:not(.dark-mode) .location-dropdown {
            background: white;
            border-color: var(--border-color);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        body:not(.dark-mode) .location-dropdown-item {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .location-dropdown-item:hover {
            background: var(--bg-tertiary);
        }

        body:not(.dark-mode) .location-dropdown-item.active {
            background: rgba(59, 130, 246, 0.1);
        }

        body:not(.dark-mode) .location-dropdown-divider {
            background: var(--border-color);
        }

        body:not(.dark-mode) .add-location-modal .add-location-dialog {
            background: white;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        body:not(.dark-mode) .add-location-input {
            background: var(--bg-tertiary);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Weather Center - Light Mode */
        body:not(.dark-mode) .weather-center {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .weather-condition {
            color: var(--text-secondary);
        }

        body:not(.dark-mode) .weather-quick-stats {
            border-color: var(--border-color);
        }

        body:not(.dark-mode) .weather-stat-label {
            color: var(--text-muted);
        }

        body:not(.dark-mode) .weather-stat-value {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .pressure-trend-indicator {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        /* Mini Cards - Light Mode */
        body:not(.dark-mode) .weather-mini-card .mini-card-label {
            color: var(--text-secondary);
        }

        body:not(.dark-mode) .weather-mini-card .mini-card-temp {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .weather-mini-card .mini-card-detail {
            color: var(--text-muted);
        }

        body:not(.dark-mode) #weatherHistoryCards .weather-mini-card:not(:last-child)::after,
        body:not(.dark-mode) #weatherForecastCards .weather-mini-card:not(:first-child)::before {
            background: var(--border-color);
        }

        /* Astronomy Bar - Light Mode */
        body:not(.dark-mode) .astronomy-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .astronomy-item.daylight {
            color: var(--text-secondary);
        }

        body:not(.dark-mode) .astronomy-item.moon {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .astronomy-separator {
            color: var(--border-color);
        }

        /* Insight Strip - Light Mode */
        body:not(.dark-mode) .insight-strip {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .time-nav-btn {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .time-nav-btn:hover {
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        body:not(.dark-mode) .time-nav-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        /* Sparkline Label - Light Mode */
        body:not(.dark-mode) .sparkline-timeframe-label {
            background: var(--bg-primary);
            color: var(--text-muted);
        }

        /* Historical Trends Section - Light Mode */
        body:not(.dark-mode) .trends-section {
            background: var(--bg-primary);
        }

        body:not(.dark-mode) .trends-title {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .trend-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .trend-card-title {
            color: var(--text-secondary);
        }

        body:not(.dark-mode) .trend-card-value {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .trend-chart-container .y-axis {
            color: var(--text-muted);
        }

        body:not(.dark-mode) .trend-chart-container .x-axis {
            color: var(--text-muted);
        }

        /* Insight Strip - Light Mode */
        body:not(.dark-mode) .insight-strip {
            background: var(--bg-primary);
        }

        body:not(.dark-mode) .insight-chip.info {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        body:not(.dark-mode) .insight-chip.advice {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        body:not(.dark-mode) .insight-chip.warning {
            background: rgba(251, 191, 36, 0.1);
            color: #d97706;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        body:not(.dark-mode) .insight-chip.critical {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        body:not(.dark-mode) .insight-chip.success {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.3);
            box-shadow: 0 0 8px rgba(34, 197, 94, 0.15);
        }

        /* Other dashboard elements */
        body:not(.dark-mode) .metrics-row,
        body:not(.dark-mode) .air-quality-row,
        body:not(.dark-mode) .dashboard-columns {
            background: var(--bg-primary);
        }

        body:not(.dark-mode) .metric-card,
        body:not(.dark-mode) .air-quality-card,
        body:not(.dark-mode) .column-metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .air-quality-subblock {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        body:not(.dark-mode) .air-quality-subblock:hover {
            background: #e2e8f0;
        }

        body:not(.dark-mode) .subblock-title {
            color: var(--text-secondary);
        }

        body:not(.dark-mode) .column-metric-card.no-data {
            border: 1px dashed var(--border-color);
        }

        body:not(.dark-mode) .metric-card-value,
        body:not(.dark-mode) .air-quality-value .aqi,
        body:not(.dark-mode) .column-metric-card .card-value {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .column-header {
            border-bottom-color: var(--border-color);
        }

        body:not(.dark-mode) .column-title {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .column-summary-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-primary) 100%);
            border-color: var(--border-color);
        }

        body:not(.dark-mode) .summary-value {
            color: var(--text-primary);
        }

        body:not(.dark-mode) .contextual-message {
            background: #e0f2fe;
            color: #1e40af;
        }

        /* Responsive adjustments */
        @media (max-width: 900px) {
            .metrics-row {
                grid-template-columns: 1fr;
            }

            .air-quality-row {
                grid-template-columns: 1fr;
            }

            .insight-strip {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .insight-strip-left {
                justify-content: center;
            }

            .time-nav-buttons {
                justify-content: center;
            }
        }

        /* ============= LEGACY WIDGET STYLES (kept for compatibility) ============= */

        /* Widget Dashboard Styles */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border-color);
        }

        .dashboard-header h2 {
            font-size: 24px;
            color: var(--text-primary);
            margin: 0;
        }

        .dashboard-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        #mySensorsCount {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .manage-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .manage-btn:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-1px);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 20px;
            margin: 0 0 8px 0;
            color: var(--text-primary);
        }

        .empty-state p {
            margin: 0;
            font-size: 14px;
        }

        .empty-state-btn {
            margin-top: 20px;
            padding: 12px 24px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .empty-state-btn:hover {
            background: var(--accent-color-2);
            transform: translateY(-1px);
        }

        .empty-state-container {
            display: flex;
            flex-direction: column;
            min-height: 400px;
        }

        .empty-state-header {
            padding: 20px;
        }

        .empty-state-location-row {
            position: relative;
            display: inline-block;
        }

        .empty-state-location-row .location-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 8px;
            min-width: 200px;
        }

        /* ============= E-PAPER STYLE DASHBOARD ============= */

        /* E-Paper Theme Toggle */
        .epaper-mode #widgetDashboard {
            background: #f8f8f8;
            filter: none;
        }

        .epaper-mode .epaper-widget {
            background: white;
            border: 2px solid #111;
            box-shadow: none;
        }

        .epaper-mode .epaper-widget .widget-svg-icon {
            filter: grayscale(100%);
        }

        /* Widget Grid Layout */
        #widgetDashboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            padding: 20px;
            background: var(--bg-primary);
        }

        /* E-Paper Style Widget */
        .epaper-widget {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            min-height: 180px;
        }

        .epaper-widget-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 12px;
        }

        .epaper-widget-header .comparison-badge {
            margin-left: auto;
        }

        .widget-svg-icon {
            width: 32px;
            height: 32px;
            flex-shrink: 0;
        }

        .widget-svg-icon svg {
            width: 100%;
            height: 100%;
        }

        .epaper-widget-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .epaper-widget-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .epaper-main-value {
            font-size: 42px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }

        .epaper-main-value .unit {
            font-size: 20px;
            font-weight: 400;
            margin-left: 2px;
        }

        .epaper-high-low {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 8px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .epaper-high-low .high {
            color: #c0392b;
        }

        .epaper-high-low .low {
            color: #2980b9;
        }

        .epaper-trend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 8px;
            font-size: 13px;
            font-weight: 600;
        }

        .epaper-trend.rising { color: #c0392b; }
        .epaper-trend.falling { color: #2980b9; }
        .epaper-trend.steady { color: var(--text-secondary); }

        .epaper-trend-arrow {
            font-size: 16px;
        }

        /* Sparkline Container */
        .epaper-sparkline {
            width: 100%;
            height: 40px;
            margin-top: 12px;
            border-top: 1px solid var(--border-color);
            padding-top: 8px;
        }

        .epaper-sparkline canvas {
            width: 100%;
            height: 100%;
        }

        .epaper-sparkline-timeframe {
            font-size: 9px;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 2px;
            opacity: 0.7;
        }

        /* Quality Badge - E-Paper Style */
        .epaper-quality {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            padding: 4px 12px;
            border: 2px solid currentColor;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .epaper-quality-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .epaper-quality.excellent { color: #27ae60; }
        .epaper-quality.good { color: #2ecc71; }
        .epaper-quality.moderate { color: #f39c12; }
        .epaper-quality.poor { color: #e67e22; }
        .epaper-quality.unhealthy { color: #e74c3c; }
        .epaper-quality.hazardous { color: #8e44ad; }

        /* Sensor Count */
        .epaper-sensor-count {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* Full Width Widgets */
        .epaper-widget.full-width {
            grid-column: span 3;
        }

        .epaper-widget.half-width {
            grid-column: span 2;
        }

        /* Chart Widget (legacy) */
        .epaper-chart-container {
            width: 100%;
            height: 200px;
            margin-top: 12px;
        }

        /* Historical Trends Section */
        .epaper-trends-section {
            grid-column: 1 / -1;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 4px;
            padding: 16px;
            margin-top: 8px;
        }

        .epaper-trends-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .epaper-section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }

        .timeframe-selector {
            display: flex;
            gap: 4px;
        }

        .timeframe-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            border-radius: 4px;
        }

        .timeframe-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .timeframe-btn.active {
            background: var(--text-primary);
            color: var(--bg-primary);
            border-color: var(--text-primary);
        }

        .epaper-trends-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .epaper-trend-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 12px;
            min-height: 140px;
        }

        .trend-card-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .epaper-trend-card canvas {
            width: 100% !important;
            height: 100px !important;
        }

        /* Sensor Status Grid */
        .epaper-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .epaper-status-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-tertiary);
        }

        .epaper-status-info {
            flex: 1;
            min-width: 0;
        }

        .epaper-status-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .epaper-status-location {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .epaper-status-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-left: 12px;
        }

        .epaper-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .epaper-status-indicator.online { background: #27ae60; }
        .epaper-status-indicator.stale { background: #f39c12; }
        .epaper-status-indicator.offline { background: #e74c3c; }

        /* Sensor deployment badges */
        .sensor-badges {
            display: flex;
            gap: 4px;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        .deployment-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-size: 9px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .deployment-badge.indoor {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .deployment-badge.outdoor {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .deployment-badge.mixed {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .deployment-badge.unknown {
            background: rgba(100, 116, 139, 0.2);
            color: #94a3b8;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .source-badge {
            display: inline-flex;
            align-items: center;
            font-size: 8px;
            padding: 1px 4px;
            border-radius: 3px;
        }

        .source-badge.manual {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }

        .source-badge.inferred {
            background: rgba(251, 191, 36, 0.15);
            color: #fbbf24;
        }

        .source-badge.unknown-source {
            background: rgba(100, 116, 139, 0.15);
            color: #64748b;
        }

        .warning-badge {
            display: inline-flex;
            align-items: center;
            gap: 2px;
            font-size: 8px;
            padding: 1px 4px;
            border-radius: 3px;
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            cursor: help;
        }

        .warning-badge svg {
            width: 10px;
            height: 10px;
        }

        /* Dashboard Header with Theme Toggle */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 0 20px;
        }

        .dashboard-header h2 {
            font-size: 22px;
            color: var(--text-primary);
            margin: 0;
        }

        .dashboard-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .theme-toggle-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .theme-toggle-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-color);
        }

        .theme-toggle-btn.active {
            background: var(--text-primary);
            color: var(--bg-primary);
        }

        /* Responsive */
        @media (max-width: 900px) {
            #widgetDashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .epaper-widget.full-width {
                grid-column: span 2;
            }

            .epaper-widget.half-width {
                grid-column: span 1;
            }
        }

        @media (max-width: 600px) {
            #widgetDashboard {
                grid-template-columns: 1fr;
            }

            .epaper-widget.full-width,
            .epaper-widget.half-width {
                grid-column: span 1;
            }

            .epaper-main-value {
                font-size: 36px;
            }
        }

        /* Chart Widget */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 16px;
        }

        /* Sensor Status Grid */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .status-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-card-name {
            font-size: var(--font-base);
            font-weight: 600;
            color: var(--text-primary);
        }

        .status-card-location {
            font-size: var(--font-sm);
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .status-card-value {
            font-size: var(--font-lg);
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Star Button for Favorites */
        .star-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            padding: 4px;
            transition: transform 0.2s;
            line-height: 1;
        }

        .star-btn:hover {
            transform: scale(1.2);
        }

        .star-btn.favorited {
            filter: drop-shadow(0 0 4px rgba(255, 193, 7, 0.6));
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .sensors-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                margin-left: 20px;
            }

            .nav-brand h1 {
                font-size: 17px;
            }

            .nav-tab {
                padding: 6px 12px;
                font-size: var(--font-base);
            }

            /* Widget responsive layout */
            .widget-large,
            .widget-medium,
            .widget-chart,
            .widget-status {
                grid-column: span 12;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .dashboard-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                width: 100%;
            }

            .widget-main-value {
                font-size: 36px;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ========================================
           Details Sidebar (Phase 1 Dashboard Redesign)
           ======================================== */
        .details-sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100vh;
            background: var(--bg-secondary);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .details-sidebar.open {
            transform: translateX(0);
        }

        .details-sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
        }

        .details-sidebar-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .details-sidebar-header {
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-color-2) 100%);
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .details-sidebar-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .details-sidebar-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .details-sidebar-title {
            font-size: 18px;
            font-weight: 600;
            flex: 1;
        }

        .details-sidebar-toggle {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            overflow: hidden;
        }

        .details-sidebar-toggle button {
            padding: 6px 12px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .details-sidebar-toggle button.active {
            background: rgba(255, 255, 255, 0.9);
            color: var(--accent-color);
            font-weight: 600;
        }

        .details-sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        /* Current Value Section */
        .details-current {
            margin-bottom: 24px;
        }

        .details-current-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .details-current-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1;
        }

        .details-current-subtext {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Quick Stats Grid */
        .details-stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .details-stat-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
        }

        .details-stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .details-stat-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .details-stat-delta {
            font-size: 12px;
            margin-left: 4px;
        }

        .details-stat-delta.positive {
            color: #22c55e;
        }

        .details-stat-delta.negative {
            color: #ef4444;
        }

        .details-stat-delta.neutral {
            color: var(--text-muted);
        }

        /* Chart Section */
        .details-chart-section {
            margin-bottom: 24px;
        }

        .details-chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .details-chart-title {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .details-time-pills {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }

        .time-pill {
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 11px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-pill:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .time-pill.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .details-chart-container {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
            height: 160px;
        }

        /* Sensor Info */
        .details-sensor-info {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .details-sensor-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .details-sensor-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .details-sensor-updated {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Action Buttons */
        .details-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .details-action-btn {
            flex: 1;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }

        .details-action-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        /* Room Details Sidebar Styles */
        .room-insight-banner {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .room-insight-banner.good {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
        }

        .room-insight-banner.moderate {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
        }

        .room-insight-banner.warning {
            background: rgba(249, 115, 22, 0.1);
            border-color: rgba(249, 115, 22, 0.3);
        }

        .room-insight-banner.critical {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.4);
        }

        .room-insight-banner.info {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .room-insight-icon {
            font-size: 20px;
        }

        .room-insight-text {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .room-current-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .room-metric-card {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
        }

        .room-metric-card .metric-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .room-metric-card .metric-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .room-metric-card .metric-unit {
            font-size: 14px;
            font-weight: 400;
            color: var(--text-muted);
        }

        .room-metric-card .metric-status {
            font-size: 11px;
            margin-top: 4px;
            color: var(--text-muted);
        }

        .room-metric-card .metric-status.good { color: #22c55e; }
        .room-metric-card .metric-status.moderate { color: #f59e0b; }
        .room-metric-card .metric-status.poor { color: #ef4444; }

        .room-metric-select,
        .aq-metric-select {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            padding: 4px 8px;
            cursor: pointer;
        }

        .room-device-info {
            background: var(--bg-tertiary);
            border-radius: 8px;
            padding: 12px;
            margin-top: 20px;
        }

        .room-device-info .device-info-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .room-device-info .device-info-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .room-device-info .device-info-item {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .room-device-info .device-info-item .device-name {
            color: var(--text-primary);
        }

        .room-device-info .device-info-item .device-updated {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Hardware Info Styles */
        .hw-info-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .hw-info-row:last-child {
            border-bottom: none;
        }

        .hw-info-label {
            font-size: 11px;
            color: var(--text-muted);
            min-width: 60px;
        }

        .hw-info-value {
            font-size: 12px;
            color: var(--text-primary);
            text-align: right;
            word-break: break-all;
        }

        .hw-sensor-id {
            font-family: monospace;
            font-size: 10px;
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 4px;
        }

        .hw-sensor-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: flex-end;
        }

        .hw-sensor-chip {
            font-size: 10px;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
        }

        /* Contributing Sensors Section (multi-sensor rooms) */
        .contributing-sensors-section {
            padding: 4px 0;
        }

        .contributing-sensors-header {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .contributing-sensors-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .contributing-sensor-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 10px 12px;
            border-left: 3px solid #3b82f6;
        }

        .contributing-sensor-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .contributing-sensor-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .contributing-sensor-color {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .contributing-sensor-metrics {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .contributing-sensor-id {
            font-size: 9px;
            font-family: monospace;
            color: var(--text-muted);
        }

        /* Period Stats Styles */
        .details-period-stats {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .period-stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .period-stats-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .period-stats-range {
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-secondary);
            padding: 3px 8px;
            border-radius: 4px;
        }

        .period-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .period-stat {
            text-align: center;
        }

        .period-stat-label {
            display: block;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 4px;
        }

        .period-stat-value {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Contextual Insights Styles */
        .details-insights {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .insights-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .insights-icon {
            font-size: 16px;
        }

        .insights-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .insights-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .insight-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
        }

        .insight-item.info {
            border-left-color: #3b82f6;
        }

        .insight-item.warning {
            border-left-color: #f59e0b;
        }

        .insight-item.alert {
            border-left-color: #ef4444;
        }

        .insight-item.success {
            border-left-color: #22c55e;
        }

        .insight-icon {
            font-size: 16px;
            flex-shrink: 0;
            margin-top: 1px;
        }

        .insight-content {
            flex: 1;
            min-width: 0;
        }

        .insight-title {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .insight-desc {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .insights-empty {
            font-size: 13px;
            color: var(--text-muted);
            text-align: center;
            padding: 12px;
        }

        /* Contributing Sensors Section */
        .details-contributing-sensors {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .contributing-sensors-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .contributing-sensors-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .contributing-sensors-count {
            font-size: 11px;
            color: var(--text-muted);
            background: var(--bg-secondary);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .contributing-sensors-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .contributing-sensor-item {
            display: flex;
            flex-direction: column;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border-left: 3px solid var(--accent-color);
        }

        .contributing-sensor-item.anomaly {
            border-left-color: #f59e0b;
        }

        .contributing-sensor-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .contributing-sensor-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
            flex: 1;
        }

        .contributing-sensor-name {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .contributing-sensor-type {
            font-size: 11px;
            color: var(--text-muted);
        }

        .contributing-sensor-hw {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 6px;
        }

        .hw-chip {
            font-size: 9px;
            color: var(--text-muted);
            font-family: monospace;
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
        }

        .contributing-sensor-value {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }

        .contributing-sensor-reading {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-color);
        }

        .contributing-sensor-diff {
            font-size: 11px;
            color: var(--text-muted);
        }

        .contributing-sensor-diff.positive {
            color: #22c55e;
        }

        .contributing-sensor-diff.negative {
            color: #ef4444;
        }

        .contributing-sensor-chart {
            width: 100%;
            height: 60px;
            margin-top: 8px;
            position: relative;
        }

        .contributing-sensor-chart canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* Swarm Sensors Section */
        .swarm-sensors-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 0 8px 0;
            margin-top: 8px;
            border-top: 1px dashed var(--border-color);
            font-size: 12px;
            color: var(--text-secondary);
        }

        .swarm-sensors-icon {
            font-size: 14px;
        }

        .swarm-sensors-title {
            font-weight: 600;
            color: #fbbf24;
        }

        .swarm-sensors-count {
            font-size: 11px;
            color: var(--text-muted);
            margin-left: auto;
        }

        .contributing-sensor-item .favorited-sensor-icon {
            font-size: 10px;
            margin-right: 4px;
        }

        .contributing-sensor-item.swarm-peer {
            opacity: 0.85;
            background: rgba(251, 191, 36, 0.05);
        }

        .contributing-sensor-item.swarm-peer .swarm-peer-icon {
            font-size: 11px;
            margin-right: 4px;
        }

        .contributing-sensor-item.swarm-peer.outlier {
            background: rgba(239, 68, 68, 0.08);
            border-left-color: #ef4444;
        }

        .contributing-sensor-item.swarm-peer .outlier-badge {
            font-size: 10px;
            color: #ef4444;
            padding: 1px 6px;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 4px;
        }

        /* Stale peer styling */
        .contributing-sensor-item.swarm-peer.stale {
            opacity: 0.6;
            background: rgba(100, 116, 139, 0.05);
        }

        .contributing-sensor-item.swarm-peer .stale-badge {
            font-size: 10px;
            color: #64748b;
            padding: 1px 6px;
            background: rgba(100, 116, 139, 0.1);
            border-radius: 4px;
        }

        .contributing-sensor-item .stale-text {
            color: #64748b !important;
        }

        /* Comparison Chart Section */
        .contributing-sensors-comparison {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .comparison-chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .comparison-chart-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .comparison-chart-container {
            height: 180px;
            position: relative;
        }

        .comparison-chart-container canvas {
            width: 100% !important;
            height: 100% !important;
        }

        .comparison-chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .comparison-legend-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            color: var(--text-muted);
        }

        .comparison-legend-color {
            width: 12px;
            height: 3px;
            border-radius: 1px;
        }

        /* Sensor Management Panel */
        .sensor-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 450px;
            height: 100vh;
            background: var(--bg-secondary);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sensor-panel.open {
            transform: translateX(0);
        }

        .sensor-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
        }

        .sensor-panel-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .sensor-panel-header {
            padding: 16px 20px;
            background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-color-2) 100%);
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .sensor-panel-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .sensor-panel-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .sensor-panel-title {
            font-size: 18px;
            font-weight: 600;
            flex: 1;
        }

        .sensor-panel-count {
            font-size: 13px;
            opacity: 0.9;
        }

        .sensor-panel-search {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .sensor-panel-search input {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
        }

        .sensor-panel-search input:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .sensor-panel-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 16px;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) var(--bg-tertiary);
            max-width: 100%;
            box-sizing: border-box;
        }

        .sensor-panel-content::-webkit-scrollbar {
            width: 8px;
        }

        .sensor-panel-content::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .sensor-panel-content::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .sensor-panel-content::-webkit-scrollbar-thumb:hover {
            background: var(--accent-color-2);
        }

        .sensor-panel-footer {
            padding: 16px;
            border-top: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .sensor-panel-view-all {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            color: var(--accent-color);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sensor-panel-view-all:hover {
            background: var(--accent-color);
            color: white;
        }

        .sensor-panel-grid {
            display: grid;
            grid-template-columns: minmax(0, 1fr);
            gap: 12px;
            width: 100%;
            box-sizing: border-box;
        }

        .sensor-panel-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            box-sizing: border-box;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .sensor-panel-card:hover {
            border-color: var(--accent-color);
        }

        .sensor-panel-card.selected {
            border-color: var(--accent-color);
            background: rgba(102, 126, 234, 0.1);
        }

        .sensor-panel-card .sensor-star {
            font-size: 20px;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .sensor-panel-card.selected .sensor-star {
            color: #fbbf24;
        }

        .sensor-panel-card .sensor-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
        }

        .sensor-panel-card .sensor-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sensor-deployment-badge {
            display: inline-block;
            margin-left: 6px;
            padding: 1px 6px;
            font-size: 10px;
            font-weight: 500;
            border-radius: 4px;
            background: var(--bg-tertiary);
            color: var(--text-muted);
            vertical-align: middle;
        }

        .sensor-deployment-badge.outdoor {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .sensor-deployment-badge.indoor {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }

        .sensor-deployment-badge.mixed {
            background: rgba(168, 85, 247, 0.15);
            color: #a855f7;
        }

        .sensor-deployment-badge.portable {
            background: rgba(251, 191, 36, 0.15);
            color: #f59e0b;
        }

        /* Swarm badge in sensor panel */
        .sensor-swarm-badge {
            display: inline-block;
            margin-left: 6px;
            padding: 1px 5px;
            font-size: 10px;
            font-weight: 500;
            border-radius: 4px;
            background: rgba(99, 102, 241, 0.15);
            color: #818cf8;
            vertical-align: middle;
        }

        /* Outlier warning badge */
        .sensor-outlier-warning {
            display: inline-block;
            margin-left: 4px;
            font-size: 11px;
            vertical-align: middle;
            cursor: help;
            animation: pulse-warning 2s infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Outlier card styling */
        .sensor-panel-card.outlier {
            border-left: 3px solid #f59e0b;
        }

        .sensor-panel-card.outlier .sensor-name {
            color: #f59e0b;
        }

        .sensor-panel-card .sensor-location {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sensor-panel-card .sensor-reading {
            text-align: right;
            flex-shrink: 0;
            min-width: 45px;
        }

        .sensor-panel-card .sensor-temp {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .sensor-panel-card .sensor-humidity {
            font-size: 11px;
            color: var(--text-muted);
        }

        .sensor-panel-card.stale {
            opacity: 0.6;
            border-color: var(--border-color);
        }

        .sensor-panel-card.stale .sensor-name,
        .sensor-panel-card.stale .sensor-temp {
            color: var(--text-muted);
        }

        .sensor-panel-card .sensor-last-seen {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .sensor-panel-card.live .sensor-last-seen {
            color: #22c55e;
        }

        @media (max-width: 500px) {
            .sensor-panel {
                width: 100%;
            }
        }

        /* Dashboard Time Range Selector */
        .dashboard-time-range {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .dashboard-time-range-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-right: 8px;
        }

        .dashboard-time-btn {
            padding: 6px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .dashboard-time-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .dashboard-time-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .dashboard-time-more {
            position: relative;
        }

        .dashboard-time-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 8px;
            display: none;
            z-index: 100;
            min-width: 120px;
        }

        .dashboard-time-dropdown.visible {
            display: block;
        }

        .dashboard-time-dropdown button {
            display: block;
            width: 100%;
            padding: 8px 12px;
            background: none;
            border: none;
            text-align: left;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 4px;
        }

        .dashboard-time-dropdown button:hover {
            background: var(--bg-tertiary);
            color: var(--accent-color);
        }

        /* Comparison Badge */
        .comparison-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        .comparison-badge.positive {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
        }

        .comparison-badge.negative {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .comparison-badge.neutral {
            background: rgba(100, 116, 139, 0.15);
            color: var(--text-muted);
        }

        /* Make widgets clickable */
        .epaper-widget.clickable {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .epaper-widget.clickable:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .epaper-widget.clickable:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        @media (max-width: 500px) {
            .details-sidebar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Main Navigation -->
    <nav class="main-nav">
        <div class="nav-brand">
            <h1>WeSense</h1>
        </div>
        <div class="nav-tabs">
            <button class="nav-tab active" data-view="dashboard">Dashboard</button>
            <span class="nav-separator">|</span>
            <button class="nav-tab" data-view="map">Map</button>
            <button class="nav-tab" data-view="regional">Regional</button>
        </div>
        <div class="nav-controls">
            <button class="header-btn" id="helpButton" title="Help & Legend">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
            </button>
            <button class="header-btn" id="refreshButton" title="Refresh sensor data">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
            </button>
            <button class="header-btn" id="darkModeToggle" title="Toggle dark/light mode">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
        </div>
    </nav>

    <!-- Map View -->
    <div id="mapView" class="view-container">
        <div id="container">
            <div id="map">
                <!-- Viewer counter overlay -->
                <div class="viewer-counter" title="Viewers online in last 60 seconds">
                    <span id="viewerCount">-</span> viewing
                </div>
                <!-- Region filter controls overlay (tiles view) -->
                <div class="map-overlay-controls" id="mapOverlayControls">
                    <span class="control-label">Metric:</span>
                    <select id="regionMetricSelect" title="Select metric for region coloring">
                        <option value="temperature">Temperature</option>
                        <option value="humidity">Humidity</option>
                        <option value="pressure">Pressure</option>
                        <option value="co2">COâ‚‚</option>
                        <option value="pm2_5">PM2.5</option>
                    </select>
                    <span class="control-label">Type:</span>
                    <div class="multi-select-dropdown" id="regionDeploymentDropdown">
                        <button class="multi-select-toggle" id="regionDeploymentToggle">
                            <span class="multi-select-label">Outdoor, Mixed</span>
                            <svg class="dropdown-arrow" width="10" height="6" viewBox="0 0 10 6" fill="currentColor">
                                <path d="M1 1l4 4 4-4"/>
                            </svg>
                        </button>
                        <div class="multi-select-options" id="regionDeploymentOptions">
                            <label class="multi-select-option select-all">
                                <input type="checkbox" value="all" id="regionDeploymentSelectAll">
                                <span>Select All</span>
                            </label>
                            <div class="multi-select-divider"></div>
                            <!-- Options populated dynamically from database -->
                        </div>
                    </div>
                    <span class="control-label">Window:</span>
                    <select id="regionTimeWindow" title="Time window for aggregation">
                        <option value="30m">30 min</option>
                        <option value="1h" selected>1 hour</option>
                        <option value="2h">2 hours</option>
                        <option value="4h">4 hours</option>
                        <option value="24h">24 hours</option>
                    </select>
                    <label class="historical-toggle" title="View historical data">
                        <input type="checkbox" id="regionHistoricalToggle">
                        <span>Historical</span>
                    </label>
                    <div class="historical-controls" id="historicalControls">
                        <input type="date" id="regionDatePicker" title="Select date">
                        <div class="hour-slider-container">
                            <input type="range" id="regionHourSlider" min="0" max="23" value="12">
                            <span id="regionHourLabel">12:00</span>
                        </div>
                    </div>
                </div>
                <!-- Sensor filter controls overlay (sensor view) -->
                <div class="map-overlay-controls active" id="sensorOverlayControls">
                    <span class="control-label">Metric:</span>
                    <select id="sensorMetricFilter" title="Filter sensors by metric">
                        <option value="all">All Metrics</option>
                        <option value="temperature">Temperature</option>
                        <option value="humidity">Humidity</option>
                        <option value="pressure">Pressure</option>
                        <option value="co2">COâ‚‚</option>
                        <option value="pm2_5">PM2.5</option>
                        <option value="pm10">PM10</option>
                        <option value="voc">VOC</option>
                    </select>
                    <span class="control-label">Type:</span>
                    <div class="multi-select-dropdown" id="deploymentFilterDropdown">
                        <button class="multi-select-toggle" id="deploymentFilterToggle">
                            <span class="multi-select-label">Outdoor, Mixed</span>
                            <svg class="dropdown-arrow" width="10" height="6" viewBox="0 0 10 6" fill="currentColor">
                                <path d="M1 1l4 4 4-4"/>
                            </svg>
                        </button>
                        <div class="multi-select-options" id="deploymentFilterOptions">
                            <label class="multi-select-option select-all">
                                <input type="checkbox" value="all" id="deploymentSelectAll">
                                <span>Select All</span>
                            </label>
                            <div class="multi-select-divider"></div>
                            <!-- Options populated dynamically from database -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar">
            <div class="sidebar-header">
                <div class="header-content">
                    <h2>WeSense</h2>
                    <p>Environmental Monitoring Network</p>
                </div>
            </div>

            <!-- Leaderboard Section (fixed 24h, unaffected by filters) -->
            <div class="sidebar-section">
                <div class="section-header" data-section="leaderboard">
                    <h3>Sensor Leaderboard <span style="font-weight: normal; font-size: 11px; opacity: 0.7;">(24h)</span></h3>
                    <span class="section-toggle">â–¼</span>
                </div>
                <div class="section-content leaderboard-content" id="leaderboard" style="padding: 8px 12px;">
                    <div id="leaderboardList">
                        <div class="leaderboard-loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Environmental Leaderboard Section -->
            <div class="sidebar-section">
                <div class="section-header" data-section="envLeaderboard">
                    <h3>Environmental Leaderboard <span style="font-weight: normal; font-size: 11px; opacity: 0.7;">(1yr)</span></h3>
                    <span class="section-toggle">â–¼</span>
                </div>
                <div class="section-content leaderboard-content" id="envLeaderboard" style="padding: 8px 12px;">
                    <div id="envLeaderboardList">
                        <div class="leaderboard-loading">Loading...</div>
                    </div>
                </div>
            </div>

            <!-- Summary Stats Section -->
            <div class="sidebar-section">
                <div class="section-header" data-section="stats">
                    <h3>Summary</h3>
                    <span class="section-toggle">â–¼</span>
                </div>
                <div class="stats section-content">
                    <div class="stat">
                        <div class="stat-value" id="activeSensors">0</div>
                        <div class="stat-label">Active Now</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="newestReading">-</div>
                        <div class="stat-label">Latest</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="regionsCount">0</div>
                        <div class="stat-label">Regions</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="countriesCount">0/195</div>
                        <div class="stat-label">Countries</div>
                    </div>
                </div>
            </div>

            <!-- Time Filter Section -->
            <div class="sidebar-section">
                <div class="section-header" data-section="timefilter">
                    <h3>Time Filter<span class="time-filter-value" id="timeFilterValue">: 30m</span></h3>
                    <span class="section-toggle">â–¼</span>
                </div>
                <div class="section-content" style="padding: 10px 15px;">
                    <div class="timeframe-selector" id="timeframeSelector">
                        <button class="timeframe-btn active" data-range="30m">30m</button>
                        <button class="timeframe-btn" data-range="1h">1h</button>
                        <button class="timeframe-btn" data-range="2h">2h</button>
                        <button class="timeframe-btn" data-range="4h">4h</button>
                        <button class="timeframe-btn" data-range="8h">8h</button>
                        <button class="timeframe-btn" data-range="24h">24h</button>
                        <button class="timeframe-btn" data-range="7d">7d</button>
                        <button class="timeframe-btn" data-range="30d">30d+</button>
                    </div>
                    <p style="font-size: 10px; margin-top: 8px; opacity: 0.8;" id="historyStatus"></p>
                </div>
            </div>

            <!-- Node Activity Distribution Section -->
            <div class="sidebar-section">
                <div class="section-header" data-section="activity">
                    <h3>Node Activity Distribution</h3>
                    <span class="section-toggle">â–¼</span>
                </div>
                <div id="agingChart" class="section-content" style="padding: 10px 15px;">
                    <div id="agingBars"></div>
                </div>
            </div>

            <!-- Filters Section -->
            <div class="sidebar-section">
                <div class="section-header" data-section="filters">
                    <h3>Sensor Filters</h3>
                    <span class="section-toggle">â–¼</span>
                </div>
                <div class="filters section-content">
                    <div class="filter-group">
                        <div class="filter-label collapsed" data-filter="source">
                            <span>Data Source<span class="filter-summary" id="sourceSummary">: All</span></span>
                        </div>
                        <div class="filter-options collapsed" id="sourceFilters" data-filter="source">
                            <button class="filter-btn active" data-filter-type="source" data-filter-value="all">All</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <div class="filter-label collapsed" data-filter="board">
                            <span>Board Type<span class="filter-summary" id="boardSummary">: All</span></span>
                        </div>
                        <div class="filter-options collapsed" id="boardFilters" data-filter="board">
                            <button class="filter-btn active" data-filter-type="board" data-filter-value="all">All</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <div class="filter-label collapsed" data-filter="location">
                            <span>Location<span class="filter-summary" id="locationSummary">: All</span></span>
                        </div>
                        <div class="filter-options collapsed" id="locationFilters" data-filter="location">
                            <button class="filter-btn active" data-filter-type="location" data-filter-value="all">All</button>
                        </div>
                    </div>
                    <div class="filter-group">
                        <div class="filter-label collapsed" data-filter="environment">
                            <span>Deployment Type<span class="filter-summary" id="environmentSummary">: All</span></span>
                        </div>
                        <div class="filter-options collapsed" id="environmentFilters" data-filter="environment">
                            <button class="filter-btn active" data-filter-type="environment" data-filter-value="all">All</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nodes Section -->
            <div class="sidebar-section" style="flex: 1; display: flex; flex-direction: column; min-height: 0;">
                <div class="section-header" data-section="sensors">
                    <h3>Nodes</h3>
                    <span class="section-toggle">â–¼</span>
                </div>
                <div class="sensors-list section-content" id="sensorsList" style="flex: 1; min-height: 0;">
                    <div class="loading">Loading sensors...</div>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End Map View -->

    <!-- Dashboard Views -->
    <div id="dashboardView" class="view-container active">
        <div class="dashboard-content">
            <!-- My Sensors View (New Widget Dashboard) -->
            <div id="mySensorsView" class="dash-view active">
                <!-- New Dashboard Layout -->
                <div id="newDashboardLayout" style="display: none;">
                    <!-- Astronomy Bar -->
                    <div class="astronomy-bar">
                        <span class="astronomy-item sun-rise">
                            <svg class="sun-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="5" fill="#fbbf24"/>
                                <g stroke="#fbbf24" stroke-width="2" stroke-linecap="round">
                                    <line x1="12" y1="1" x2="12" y2="4"/>
                                    <line x1="12" y1="20" x2="12" y2="23"/>
                                    <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/>
                                    <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
                                    <line x1="1" y1="12" x2="4" y2="12"/>
                                    <line x1="20" y1="12" x2="23" y2="12"/>
                                    <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
                                    <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/>
                                </g>
                            </svg>
                            <span id="sunriseTime">--:--</span>
                        </span>
                        <span class="astronomy-separator">â†’</span>
                        <span class="astronomy-item sun-set">
                            <svg class="sun-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 7a5 5 0 0 1 5 5h-10a5 5 0 0 1 5-5z" fill="#fb923c"/>
                                <line x1="2" y1="12" x2="22" y2="12" stroke="#475569" stroke-width="1"/>
                                <g stroke="#fb923c" stroke-width="2" stroke-linecap="round">
                                    <line x1="12" y1="1" x2="12" y2="4"/>
                                    <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/>
                                    <line x1="1" y1="12" x2="4" y2="12"/>
                                    <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/>
                                    <line x1="20" y1="12" x2="23" y2="12"/>
                                </g>
                            </svg>
                            <span id="sunsetTime">--:--</span>
                        </span>
                        <span class="astronomy-item daylight">Day <span id="daylightDuration">--h --m</span></span>
                        <span class="astronomy-separator">|</span>
                        <span class="astronomy-item moon"><span id="moonPhase">ðŸŒ‘ New Moon</span></span>
                        <span class="astronomy-separator">|</span>
                        <span class="astronomy-item photo-times">
                            <svg class="photo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <!-- Camera body -->
                                <rect x="2" y="6" width="20" height="14" rx="2" stroke="#fb923c" stroke-width="1.5" fill="none"/>
                                <!-- Viewfinder bump -->
                                <path d="M8 6V4.5C8 3.67 8.67 3 9.5 3h5c.83 0 1.5.67 1.5 1.5V6" stroke="#fb923c" stroke-width="1.5" fill="none"/>
                                <!-- Lens outer -->
                                <circle cx="12" cy="13" r="4.5" stroke="#fb923c" stroke-width="1.5" fill="none"/>
                                <!-- Lens inner -->
                                <circle cx="12" cy="13" r="2" fill="#fb923c"/>
                                <!-- Flash -->
                                <rect x="17" y="8" width="3" height="2" rx="0.5" fill="#fb923c"/>
                            </svg>
                            <span class="photo-time blue" id="blueHourAM" title="Morning blue hour">--:--</span>
                            <span class="photo-time golden" id="goldenHourAM" title="Morning golden hour">--:--</span>
                            <span class="photo-time golden" id="goldenHourPM" title="Evening golden hour">--:--</span>
                            <span class="photo-time blue" id="blueHourPM" title="Evening blue hour">--:--</span>
                        </span>
                    </div>

                    <!-- Weather Summary Hero -->
                    <div class="weather-hero" id="weatherHero">
                        <!-- Ambient fog/mist canvas overlay -->
                        <canvas class="hero-ambient-canvas" id="heroAmbientCanvas"></canvas>
                        <!-- Sun rays overlay for clear/sunny weather -->
                        <div class="hero-sun-rays"></div>
                        <!-- Location Selector (far left) -->
                        <div class="hero-location">
                            <!-- Global Swarm Toggle -->
                            <button class="hero-swarm-toggle hidden" id="heroSwarmToggle" title="Toggle between your sensors and swarm average">
                                <svg class="broadcast-icon" width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <circle cx="12" cy="12" r="3" fill="currentColor"/>
                                    <path d="M12 5C8.13 5 5 8.13 5 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
                                    <path d="M12 5C15.87 5 19 8.13 19 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.6"/>
                                    <path d="M12 1C6.48 1 2 5.48 2 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.3"/>
                                    <path d="M12 1C17.52 1 22 5.48 22 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.3"/>
                                </svg>
                                <span class="swarm-toggle-count" id="heroSwarmCount">1 + 5</span>
                            </button>
                            <div class="location-row">
                                <button class="location-selector" id="locationSelector">
                                    <span class="location-name" id="dashboardLocationName">Home</span>
                                    <span class="location-dropdown-icon">â–¾</span>
                                </button>
                                <button class="location-settings-btn" id="manageSensorsBtn" title="Manage Sensors">
                                    âš™ï¸
                                </button>
                                <!-- Location Dropdown Menu -->
                                <div class="location-dropdown" id="locationDropdown">
                                    <div class="location-dropdown-list" id="locationDropdownList">
                                        <!-- Locations will be populated dynamically -->
                                    </div>
                                    <div class="location-dropdown-divider"></div>
                                    <button class="location-dropdown-action" id="addLocationBtn">
                                        <span class="dropdown-action-icon">+</span>
                                        Add Location
                                    </button>
                                    <div class="location-dropdown-divider"></div>
                                    <button class="location-dropdown-action secondary" id="exportLocationsBtn">
                                        <span class="dropdown-action-icon">â†“</span>
                                        Export Backup
                                    </button>
                                    <button class="location-dropdown-action secondary" id="importLocationsBtn">
                                        <span class="dropdown-action-icon">â†‘</span>
                                        Import Backup
                                    </button>
                                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                                </div>
                            </div>
                            <div class="location-subtitle" id="dashboardLocationSubtitle">Local Sensors</div>
                        </div>

                        <!-- Left: Historical Comparisons (card grid) -->
                        <div class="weather-side-cards" id="weatherHistoryCards">
                            <!-- Yesterday Card -->
                            <div class="weather-mini-card" id="cardYesterday">
                                <div class="mini-card-icon" id="iconYesterday"></div>
                                <div class="mini-card-content">
                                    <div class="mini-card-label">Yesterday</div>
                                    <div class="mini-card-temp">
                                        <span id="histYesterday">--Â°</span>
                                        <span class="mini-card-diff" id="histYesterdayDiff"></span>
                                    </div>
                                    <div class="mini-card-detail" id="histYesterdayTime"></div>
                                </div>
                            </div>
                            <!-- 24h Ago Card -->
                            <div class="weather-mini-card" id="card24h">
                                <div class="mini-card-icon" id="icon24h"></div>
                                <div class="mini-card-content">
                                    <div class="mini-card-label">24h Change</div>
                                    <div class="mini-card-temp">
                                        <span id="hist24hChange">--</span>
                                    </div>
                                    <div class="mini-card-detail" id="hist24hTrend"></div>
                                </div>
                            </div>
                            <!-- Last Week Card -->
                            <div class="weather-mini-card" id="cardLastWeek">
                                <div class="mini-card-icon" id="iconLastWeek"></div>
                                <div class="mini-card-content">
                                    <div class="mini-card-label">Last Week</div>
                                    <div class="mini-card-temp">
                                        <span id="histLastWeek">--Â°</span>
                                        <span class="mini-card-diff" id="histLastWeekDiff"></span>
                                    </div>
                                    <div class="mini-card-detail" id="histLastWeekDay"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Center: Main icon and condition -->
                        <div class="weather-center">
                            <div class="weather-icon-main" id="weatherIconMain">
                                <!-- SVG weather icon injected dynamically -->
                            </div>
                            <div class="weather-condition" id="weatherCondition">Clear & Warm</div>
                            <div class="weather-quick-stats">
                                <div class="weather-stat">
                                    <span class="weather-stat-label">H / L</span>
                                    <span class="weather-stat-value" id="weatherHighLow">--Â° / --Â°</span>
                                </div>
                                <div class="weather-stat">
                                    <span class="weather-stat-label">Humidity</span>
                                    <span class="weather-stat-value" id="weatherHumidity">--%</span>
                                </div>
                                <div class="weather-stat">
                                    <span class="weather-stat-label">AQI</span>
                                    <span class="weather-stat-value" id="weatherAqi">--</span>
                                </div>
                            </div>
                            <div class="pressure-trend-indicator steady" id="pressureTrendIndicator">
                                <span id="pressureTrendIcon">â†’</span>
                                <span id="pressureTrendText">Pressure steady</span>
                            </div>
                        </div>

                        <!-- Right: Predictions (card grid) -->
                        <div class="weather-side-cards" id="weatherForecastCards">
                            <!-- In 3h Card -->
                            <div class="weather-mini-card" id="card3h">
                                <div class="mini-card-icon" id="icon3h"></div>
                                <div class="mini-card-content">
                                    <div class="mini-card-label">In 3 Hours</div>
                                    <div class="mini-card-temp">
                                        <span id="pred3h">--Â°</span>
                                        <span class="mini-card-diff" id="pred3hDiff"></span>
                                    </div>
                                    <div class="mini-card-detail" id="pred3hTime"></div>
                                </div>
                            </div>
                            <!-- Tonight Card -->
                            <div class="weather-mini-card" id="cardTonight">
                                <div class="mini-card-icon" id="iconTonight"></div>
                                <div class="mini-card-content">
                                    <div class="mini-card-label">Tonight</div>
                                    <div class="mini-card-temp">
                                        <span id="predTonight">--Â°</span>
                                    </div>
                                    <div class="mini-card-detail" id="predTonightRange"></div>
                                </div>
                            </div>
                            <!-- Tomorrow Card -->
                            <div class="weather-mini-card" id="cardTomorrow">
                                <div class="mini-card-icon" id="iconTomorrow"></div>
                                <div class="mini-card-content">
                                    <div class="mini-card-label">Tomorrow</div>
                                    <div class="mini-card-temp">
                                        <span id="predTomorrow">--Â°</span>
                                    </div>
                                    <div class="mini-card-detail" id="predTomorrowRange"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Time/Date (far right) -->
                        <div class="hero-datetime">
                            <div class="hero-time" id="dashboardTime">--:--</div>
                            <div class="hero-date" id="dashboardDate">---</div>
                        </div>
                    </div>

                    <!-- Insight Strip - Alerts left, Time buttons right -->
                    <div class="insight-strip" id="insightStrip">
                        <div class="insight-strip-left">
                            <!-- Insights will be populated dynamically here -->
                            <div id="swarmPrompt" class="swarm-prompt" style="display: none;">
                                <!-- Content populated by JavaScript -->
                            </div>
                        </div>
                        <div class="time-nav-buttons">
                            <button class="time-nav-btn" data-range="1h">1h</button>
                            <button class="time-nav-btn" data-range="8h">8h</button>
                            <button class="time-nav-btn active" data-range="24h">24h</button>
                            <button class="time-nav-btn" data-range="7d">7d</button>
                            <button class="time-nav-btn" data-range="more">More â–¾</button>
                        </div>
                    </div>

                    <div class="metrics-row">

                        <!-- Temperature Card -->
                        <div class="metric-card" data-metric="temperature" id="metricCardTemp">
                            <!-- Thermometer overlay -->
                            <div class="chart-overlay-icon">
                                <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <rect x="18" y="6" width="12" height="26" rx="6" stroke="#f97316" stroke-width="2" fill="none"/>
                                    <circle cx="24" cy="38" r="6" fill="#f97316"/>
                                    <rect x="21" y="14" width="6" height="18" rx="3" fill="#f97316"/>
                                    <line x1="32" y1="12" x2="36" y2="12" stroke="#f97316" stroke-width="2"/>
                                    <line x1="32" y1="18" x2="36" y2="18" stroke="#f97316" stroke-width="2"/>
                                    <line x1="32" y1="24" x2="36" y2="24" stroke="#f97316" stroke-width="2"/>
                                </svg>
                            </div>
                            <div class="metric-card-header">
                                <span class="metric-card-title">Temperature</span>
                                <span class="sensor-quality-badge-container" id="tempQualityBadge"></span>
                                <button class="swarm-toggle hidden" id="tempSwarmToggle" title="Toggle between your sensors and swarm average">
                                    <span class="swarm-toggle-icon">ðŸ</span>
                                    <span class="swarm-toggle-label">Swarm</span>
                                </button>
                                <div class="metric-card-comparison">
                                    <span>vs yesterday</span>
                                    <span class="diff neutral" id="tempCardDiff">--</span>
                                </div>
                            </div>
                            <div class="metric-card-value"><span id="tempCardValue">--</span>Â°C</div>
                            <div class="metric-card-secondary" id="tempCardSecondary">Feels like --Â°C</div>
                            <div class="metric-card-swarm-value hidden" id="tempSwarmValue">
                                <span class="swarm-label">ðŸ Swarm:</span>
                                <span class="swarm-reading">--Â°C</span>
                            </div>
                            <div class="metric-card-my-value hidden" id="tempMyValue">
                                <span class="my-label">â­ Mine:</span>
                                <span class="my-reading">--Â°C</span>
                            </div>
                            <div class="metric-card-range" id="tempCardRange">
                                <span class="range-low" id="tempRangeLow">--Â°</span>
                                <div class="range-bar">
                                    <div class="range-fill" id="tempRangeFill" style="left: 0%; width: 100%;"></div>
                                    <div class="range-marker" id="tempRangeMarker" style="left: 50%;"></div>
                                </div>
                                <span class="range-high" id="tempRangeHigh">--Â°</span>
                            </div>
                            <div class="metric-card-sparkline">
                                <div class="y-axis">
                                    <span id="tempYMax">--</span>
                                    <span id="tempYMid">--</span>
                                    <span id="tempYMin">--</span>
                                </div>
                                <div class="chart-area">
                                    <canvas id="tempCardSparkline"></canvas>
                                </div>
                                <div class="x-axis" id="tempXAxis">
                                    <span>--:--</span>
                                    <span>--:--</span>
                                    <span>now</span>
                                </div>
                            </div>
                        </div>

                        <!-- Humidity Card -->
                        <div class="metric-card" data-metric="humidity" id="metricCardHumidity">
                            <!-- Water droplet overlay -->
                            <div class="chart-overlay-icon">
                                <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M24 6C24 6 10 22 10 32c0 7.7 6.3 14 14 14s14-6.3 14-14C38 22 24 6 24 6z"
                                          stroke="#06b6d4" stroke-width="2" fill="none"/>
                                    <path d="M24 12C24 12 14 24 14 31c0 5.5 4.5 10 10 10s10-4.5 10-10C34 24 24 12 24 12z"
                                          fill="#06b6d4" opacity="0.3"/>
                                    <ellipse cx="18" cy="30" rx="3" ry="4" fill="#06b6d4" opacity="0.5"/>
                                </svg>
                            </div>
                            <div class="metric-card-header">
                                <span class="metric-card-title">Humidity</span>
                                <span class="sensor-quality-badge-container" id="humidityQualityBadge"></span>
                                <button class="swarm-toggle hidden" id="humiditySwarmToggle" title="Toggle between your sensors and swarm average">
                                    <span class="swarm-toggle-icon">ðŸ</span>
                                    <span class="swarm-toggle-label">Swarm</span>
                                </button>
                                <div class="metric-card-comparison">
                                    <span>vs yesterday</span>
                                    <span class="diff neutral" id="humidityCardDiff">--</span>
                                </div>
                            </div>
                            <div class="metric-card-value"><span id="humidityCardValue">--</span>%</div>
                            <div class="metric-card-secondary" id="humidityCardSecondary">Dew point --Â°C</div>
                            <div class="metric-card-swarm-value hidden" id="humiditySwarmValue">
                                <span class="swarm-label">ðŸ Swarm:</span>
                                <span class="swarm-reading">--%</span>
                            </div>
                            <div class="metric-card-my-value hidden" id="humidityMyValue">
                                <span class="my-label">â­ Mine:</span>
                                <span class="my-reading">--%</span>
                            </div>
                            <div class="metric-card-range" id="humidityCardRange">
                                <span class="range-low" id="humidityRangeLow">--%</span>
                                <div class="range-bar">
                                    <div class="range-fill" id="humidityRangeFill" style="left: 0%; width: 100%;"></div>
                                    <div class="range-marker" id="humidityRangeMarker" style="left: 50%;"></div>
                                </div>
                                <span class="range-high" id="humidityRangeHigh">--%</span>
                            </div>
                            <div class="metric-card-sparkline">
                                <div class="y-axis">
                                    <span id="humidityYMax">--</span>
                                    <span id="humidityYMid">--</span>
                                    <span id="humidityYMin">--</span>
                                </div>
                                <div class="chart-area">
                                    <canvas id="humidityCardSparkline"></canvas>
                                </div>
                                <div class="x-axis" id="humidityXAxis">
                                    <span>--:--</span>
                                    <span>--:--</span>
                                    <span>now</span>
                                </div>
                            </div>
                        </div>

                        <!-- Pressure Card -->
                        <div class="metric-card" data-metric="pressure" id="metricCardPressure">
                            <!-- Barometer overlay -->
                            <div class="chart-overlay-icon">
                                <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="24" cy="24" r="18" stroke="#8b5cf6" stroke-width="2" fill="none"/>
                                    <circle cx="24" cy="24" r="14" stroke="#8b5cf6" stroke-width="1" opacity="0.4" fill="none"/>
                                    <line x1="24" y1="10" x2="24" y2="14" stroke="#8b5cf6" stroke-width="2"/>
                                    <line x1="24" y1="34" x2="24" y2="38" stroke="#8b5cf6" stroke-width="2"/>
                                    <line x1="10" y1="24" x2="14" y2="24" stroke="#8b5cf6" stroke-width="2"/>
                                    <line x1="34" y1="24" x2="38" y2="24" stroke="#8b5cf6" stroke-width="2"/>
                                    <circle cx="24" cy="24" r="3" fill="#8b5cf6"/>
                                    <line x1="24" y1="24" x2="32" y2="16" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="metric-card-header">
                                <span class="metric-card-title">Pressure</span>
                                <span class="sensor-quality-badge-container" id="pressureQualityBadge"></span>
                                <button class="swarm-toggle hidden" id="pressureSwarmToggle" title="Toggle between your sensors and swarm average">
                                    <span class="swarm-toggle-icon">ðŸ</span>
                                    <span class="swarm-toggle-label">Swarm</span>
                                </button>
                                <div class="metric-card-comparison">
                                    <span>vs yesterday</span>
                                    <span class="diff neutral" id="pressureCardDiff">--</span>
                                </div>
                            </div>
                            <div class="metric-card-value"><span id="pressureCardValue">----</span> hPa</div>
                            <div class="metric-card-secondary" id="pressureCardSecondary">Steady</div>
                            <div class="metric-card-swarm-value hidden" id="pressureSwarmValue">
                                <span class="swarm-label">ðŸ Swarm:</span>
                                <span class="swarm-reading">---- hPa</span>
                            </div>
                            <div class="metric-card-my-value hidden" id="pressureMyValue">
                                <span class="my-label">â­ Mine:</span>
                                <span class="my-reading">---- hPa</span>
                            </div>
                            <div class="metric-card-range" id="pressureCardRange">
                                <span class="range-low" id="pressureRangeLow">----</span>
                                <div class="range-bar">
                                    <div class="range-fill" id="pressureRangeFill" style="left: 0%; width: 100%;"></div>
                                    <div class="range-marker" id="pressureRangeMarker" style="left: 50%;"></div>
                                </div>
                                <span class="range-high" id="pressureRangeHigh">----</span>
                            </div>
                            <div class="metric-card-sparkline">
                                <div class="y-axis">
                                    <span id="pressureYMax">--</span>
                                    <span id="pressureYMid">--</span>
                                    <span id="pressureYMin">--</span>
                                </div>
                                <div class="chart-area">
                                    <canvas id="pressureCardSparkline"></canvas>
                                </div>
                                <div class="x-axis" id="pressureXAxis">
                                    <span>--:--</span>
                                    <span>--:--</span>
                                    <span>now</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Outdoor/Indoor Section -->
                    <div class="air-quality-row">
                        <!-- Outdoor -->
                        <div class="air-quality-card outdoor-expandable" id="outdoorSection">
                            <div class="air-quality-header outdoor">
                                <span>Outdoor</span>
                                <svg class="header-icon" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M24 40C24 40 8 32 8 18C8 10 14 6 24 6C34 6 40 10 40 18C40 32 24 40 24 40Z"
                                          stroke="currentColor" stroke-width="2" fill="none"/>
                                    <path d="M24 38C18 30 14 22 14 16C14 12 18 10 24 10"
                                          stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                            </div>

                            <!-- Air Quality sub-block -->
                            <div class="air-quality-subblock" data-metric="pm2_5" id="outdoorAirCard">
                                <div class="subblock-header">
                                    <span class="subblock-title">Air Quality</span>
                                    <span class="sensor-quality-badge-container" id="outdoorAirQualityBadge"></span>
                                    <div class="air-quality-value">
                                        <span class="aqi" id="outdoorAqiValue">AQI --</span>
                                        <span class="air-quality-badge good" id="outdoorAqiBadge">
                                            <span class="dot"></span>
                                            <span id="outdoorAqiLabel">--</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="air-quality-details" id="outdoorAqiDetails">PM2.5: -- Âµg/mÂ³</div>
                                <div class="air-quality-sparkline">
                                    <canvas id="outdoorAqiSparkline"></canvas>
                                </div>
                            </div>

                            <!-- Outdoor contributing sensors container -->
                            <div class="outdoor-sensors-container" id="outdoorSensorsContainer">
                                <!-- Outdoor sensor cards will be populated dynamically -->
                            </div>
                        </div>

                        <!-- Indoor -->
                        <div class="air-quality-card indoor-expandable" id="indoorSection">
                            <div class="air-quality-header indoor">
                                <span>Indoor</span>
                                <svg class="header-icon" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M8 22L24 8L40 22V40H8V22Z" stroke="currentColor" stroke-width="2" fill="none"/>
                                    <rect x="18" y="28" width="12" height="12" stroke="currentColor" stroke-width="2" fill="none"/>
                                </svg>
                            </div>

                            <!-- Air Quality sub-block -->
                            <div class="air-quality-subblock" data-metric="co2" id="indoorAirCard">
                                <div class="subblock-header">
                                    <span class="subblock-title">Air Quality</span>
                                    <span class="sensor-quality-badge-container" id="indoorAirQualityBadge"></span>
                                    <div class="air-quality-value">
                                        <span class="aqi" id="indoorAqiValue">IAQI --</span>
                                        <span class="air-quality-badge good" id="indoorAqiBadge">
                                            <span class="dot"></span>
                                            <span id="indoorAqiLabel">--</span>
                                        </span>
                                    </div>
                                </div>
                                <div class="air-quality-details" id="indoorAqiDetails">CO2: -- ppm</div>
                                <div class="air-quality-sparkline">
                                    <canvas id="indoorAqiSparkline"></canvas>
                                </div>
                            </div>

                            <!-- Per-room cards container -->
                            <div class="indoor-rooms-container" id="indoorRoomsContainer">
                                <!-- Room cards will be populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Contextual Message -->
                    <div class="contextual-message" id="contextualMessage"></div>
                </div>

                <div id="dashboardLoading" class="empty-state">
                    <div class="empty-icon loading-spinner"></div>
                    <h3>Loading sensors...</h3>
                    <p>Fetching your sensor data</p>
                </div>

                <div id="noFavoritesMessage" class="empty-state-container" style="display: none;">
                    <!-- Location selector header - matches dashboard position -->
                    <div class="empty-state-header" id="emptyStateLocation" style="display: none;">
                        <div class="empty-state-location-row">
                            <button class="location-selector" id="emptyStateLocationBtn">
                                <span class="location-name" id="emptyStateLocationName">Home</span>
                                <span class="location-dropdown-icon">â–¾</span>
                            </button>
                            <!-- Location Dropdown Menu -->
                            <div class="location-dropdown" id="emptyStateLocationDropdown">
                                <div class="location-dropdown-list" id="emptyStateLocationList">
                                    <!-- Populated dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Empty state content -->
                    <div class="empty-state">
                        <div class="empty-icon star-icon"></div>
                        <h3>No Sensors Selected</h3>
                        <p>Add sensors to monitor on your dashboard.</p>
                        <button class="empty-state-btn" id="emptyStateAddBtn">Add Sensors</button>
                    </div>
                </div>

                <div id="widgetDashboard" style="display: none;">
                    <!-- Temperature Widget -->
                    <div class="epaper-widget clickable" id="tempWidget" data-metric="temperature">
                        <div class="epaper-widget-header">
                            <div class="widget-svg-icon" id="tempIcon"></div>
                            <span class="epaper-widget-title">Temperature</span>
                            <span class="comparison-badge neutral" id="tempComparison" title="vs yesterday">--</span>
                        </div>
                        <div class="epaper-widget-body">
                            <div class="epaper-main-value"><span id="avgTemp">--</span><span class="unit">Â°C</span></div>
                            <div class="epaper-high-low">
                                <span class="high">â†‘ <span id="highTemp">--</span>Â°</span>
                                <span class="low">â†“ <span id="lowTemp">--</span>Â°</span>
                            </div>
                            <div class="epaper-sparkline"><canvas id="tempSparkline"></canvas><div class="epaper-sparkline-timeframe" id="sparklineTimeframe">Last 24 hours</div></div>
                            <div class="epaper-sensor-count" id="tempSensorCount">-- sensors</div>
                        </div>
                    </div>

                    <!-- Humidity Widget -->
                    <div class="epaper-widget clickable" id="humidityWidget" data-metric="humidity">
                        <div class="epaper-widget-header">
                            <div class="widget-svg-icon" id="humidityIcon"></div>
                            <span class="epaper-widget-title">Humidity</span>
                            <span class="comparison-badge neutral" id="humidityComparison" title="vs yesterday">--</span>
                        </div>
                        <div class="epaper-widget-body">
                            <div class="epaper-main-value"><span id="avgHumidity">--</span><span class="unit">%</span></div>
                            <div class="epaper-high-low">
                                <span class="high">â†‘ <span id="highHumidity">--</span>%</span>
                                <span class="low">â†“ <span id="lowHumidity">--</span>%</span>
                            </div>
                            <div class="epaper-sparkline"><canvas id="humiditySparkline"></canvas><div class="epaper-sparkline-timeframe">Last 24 hours</div></div>
                            <div class="epaper-sensor-count" id="humSensorCount">-- sensors</div>
                        </div>
                    </div>

                    <!-- Pressure Widget -->
                    <div class="epaper-widget clickable" id="pressureWidget" data-metric="pressure">
                        <div class="epaper-widget-header">
                            <div class="widget-svg-icon" id="pressureIcon"></div>
                            <span class="epaper-widget-title">Pressure</span>
                            <span class="comparison-badge neutral" id="pressureComparison" title="vs yesterday">--</span>
                        </div>
                        <div class="epaper-widget-body">
                            <div class="epaper-main-value"><span id="avgPressure">----</span><span class="unit"> hPa</span></div>
                            <div class="epaper-trend steady" id="pressureTrend">
                                <span class="epaper-trend-arrow">â†’</span>
                                <span>Steady</span>
                            </div>
                            <div class="epaper-sparkline"><canvas id="pressureSparkline"></canvas><div class="epaper-sparkline-timeframe">Last 24 hours</div></div>
                            <div class="epaper-sensor-count" id="pressSensorCount">-- sensors</div>
                        </div>
                    </div>

                    <!-- CO2 Widget -->
                    <div class="epaper-widget clickable" id="co2Widget" data-metric="co2">
                        <div class="epaper-widget-header">
                            <div class="widget-svg-icon" id="co2Icon"></div>
                            <span class="epaper-widget-title">COâ‚‚</span>
                            <span class="comparison-badge neutral" id="co2Comparison" title="vs yesterday">--</span>
                        </div>
                        <div class="epaper-widget-body">
                            <div class="epaper-main-value"><span id="avgCo2">---</span><span class="unit"> ppm</span></div>
                            <div class="epaper-quality excellent" id="co2Quality">
                                <span class="epaper-quality-dot"></span>
                                <span>Excellent</span>
                            </div>
                            <div class="epaper-sparkline"><canvas id="co2Sparkline"></canvas><div class="epaper-sparkline-timeframe">Last 24 hours</div></div>
                            <div class="epaper-sensor-count" id="co2SensorCount">-- sensors</div>
                        </div>
                    </div>

                    <!-- PM2.5 Widget -->
                    <div class="epaper-widget clickable" id="pm25Widget" data-metric="pm2_5">
                        <div class="epaper-widget-header">
                            <div class="widget-svg-icon" id="pm25Icon"></div>
                            <span class="epaper-widget-title">PM2.5</span>
                            <span class="comparison-badge neutral" id="pm25Comparison" title="vs yesterday">--</span>
                        </div>
                        <div class="epaper-widget-body">
                            <div class="epaper-main-value"><span id="avgPm25">--</span><span class="unit"> Âµg/mÂ³</span></div>
                            <div class="epaper-quality good" id="pm25Quality">
                                <span class="epaper-quality-dot"></span>
                                <span>Good</span>
                            </div>
                            <div class="epaper-sparkline"><canvas id="pm25Sparkline"></canvas><div class="epaper-sparkline-timeframe">Last 24 hours</div></div>
                            <div class="epaper-sensor-count" id="pm25SensorCount">-- sensors</div>
                        </div>
                    </div>

                    <!-- VOC Widget -->
                    <div class="epaper-widget" id="vocWidget">
                        <div class="epaper-widget-header">
                            <div class="widget-svg-icon" id="vocIcon"></div>
                            <span class="epaper-widget-title">VOC Index</span>
                        </div>
                        <div class="epaper-widget-body">
                            <div class="epaper-main-value"><span id="avgVoc">---</span></div>
                            <div class="epaper-quality excellent" id="vocQuality">
                                <span class="epaper-quality-dot"></span>
                                <span>Excellent</span>
                            </div>
                            <div class="epaper-sparkline"><canvas id="vocSparkline"></canvas><div class="epaper-sparkline-timeframe">Last 24 hours</div></div>
                            <div class="epaper-sensor-count" id="vocSensorCount">-- sensors</div>
                        </div>
                    </div>

                    <!-- Trend Charts Section -->
                    <div class="epaper-trends-section">
                        <div class="epaper-trends-header">
                            <h3 class="epaper-section-title">Historical Trends</h3>
                            <div class="timeframe-selector" id="trendTimeframeSelector">
                                <button class="timeframe-btn active" data-range="24h">24h</button>
                                <button class="timeframe-btn" data-range="7d">Week</button>
                                <button class="timeframe-btn" data-range="30d">Month</button>
                                <button class="timeframe-btn" data-range="365d">Year</button>
                            </div>
                        </div>
                        <div class="epaper-trends-grid">
                            <div class="epaper-trend-card">
                                <div class="trend-card-title">Temperature <span class="trend-timeframe"></span></div>
                                <canvas id="trendChartTemp"></canvas>
                            </div>
                            <div class="epaper-trend-card">
                                <div class="trend-card-title">Humidity <span class="trend-timeframe"></span></div>
                                <canvas id="trendChartHumidity"></canvas>
                            </div>
                            <div class="epaper-trend-card">
                                <div class="trend-card-title">Pressure <span class="trend-timeframe"></span></div>
                                <canvas id="trendChartPressure"></canvas>
                            </div>
                            <div class="epaper-trend-card">
                                <div class="trend-card-title">COâ‚‚ <span class="trend-timeframe"></span></div>
                                <canvas id="trendChartCo2"></canvas>
                            </div>
                            <div class="epaper-trend-card">
                                <div class="trend-card-title">PM2.5 <span class="trend-timeframe"></span></div>
                                <canvas id="trendChartPm25"></canvas>
                            </div>
                            <div class="epaper-trend-card">
                                <div class="trend-card-title">VOC Index <span class="trend-timeframe"></span></div>
                                <canvas id="trendChartVoc"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Sensor Status - Full Width -->
                    <div class="epaper-widget full-width" id="statusWidget">
                        <div class="epaper-widget-header">
                            <div class="widget-svg-icon" id="statusIcon"></div>
                            <span class="epaper-widget-title">Sensor Status</span>
                        </div>
                        <div class="epaper-widget-body" style="align-items: stretch;">
                            <div class="epaper-status-grid" id="sensorStatusGrid">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Overview (formerly My Sensors - all sensors with star buttons) -->
            <div id="overviewView" class="dash-view">
                <div class="sensors-header">
                    <button class="back-to-dashboard-btn" id="backToDashboardBtn">â† Back to Dashboard</button>
                    <h2>All Sensors</h2>
                    <div class="sensors-count" id="overviewSensorCount">0 devices</div>
                </div>
                <div class="overview-search">
                    <input type="text" id="deviceSearchInput" placeholder="Search devices by name, ID, or location..." />
                </div>
                <div class="sensors-grid" id="overviewGrid">
                    <div class="loading">Loading sensors...</div>
                </div>
            </div>

            <!-- Regional View -->
            <div id="regionalView" class="dash-view">
                <div class="regional-header">
                    <h2>Regional Overview</h2>
                    <p>Aggregated sensor data by geographic region</p>
                </div>
                <div class="regional-content">
                    <p style="opacity: 0.6; text-align: center; padding: 40px;">Coming soon...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Sensor Icon Legend</h2>
                <button class="modal-close" id="closeHelp">&times;</button>
            </div>
            <div class="modal-body">
                <div class="legend-section">
                    <h3>Segmented Ring</h3>
                    <p>Each sensor icon has 4 colored segments showing different measurements:</p>
                    <div class="legend-item">
                        <div class="legend-position">Top Left</div>
                        <div class="legend-metric">Temperature</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-position">Top Right</div>
                        <div class="legend-metric">Humidity</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-position">Bottom Left</div>
                        <div class="legend-metric">Pressure (atmospheric)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-position">Bottom Right</div>
                        <div class="legend-metric">COâ‚‚ - Carbon Dioxide</div>
                    </div>
                    <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">Grey segments indicate no data available for that metric.</p>
                </div>

                <div class="legend-section">
                    <h3>Center Leaf Icon</h3>
                    <p>The leaf shows overall air quality health:</p>
                    <div class="legend-item">
                        <div class="legend-icon" style="color: #2ecc71;"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66l.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8z"/></svg> Excellent</div>
                        <div class="legend-metric">Excellent air quality (80-100)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="color: #e8b14d;"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66l.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8z"/></svg> Moderate</div>
                        <div class="legend-metric">Moderate air quality (60-79)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="color: #a67c52;"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66l.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8z"/></svg> Poor</div>
                        <div class="legend-metric">Poor air quality (40-59)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="color: #654321;"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M17 8C8 10 5.9 16.17 3.82 21.34l1.89.66l.95-2.3c.48.17.98.3 1.34.3C19 20 22 3 22 3c-1 2-8 2.25-13 3.25S2 11.5 2 13.5s1.75 3.75 1.75 3.75C7 8 17 8 17 8z"/></svg> Unhealthy</div>
                        <div class="legend-metric">Unhealthy air quality (&lt;40)</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon" style="color: #999;">â€” No data</div>
                        <div class="legend-metric">No air quality data available</div>
                    </div>
                </div>

                <div class="legend-section">
                    <h3>Segment Colour Guide</h3>
                    <p>Each segment changes colour based on the reading. Colour ranges follow international health and meteorological standards:</p>

                    <h4 style="font-size: 14px; margin: 16px 0 8px 0; color: var(--text-primary);">Temperature (Top Left)</h4>
                    <p style="font-size: 12px; margin-bottom: 8px;">Based on WHO thermal comfort standards:</p>
                    <div style="display: grid; gap: 6px; font-size: 13px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #3498db; border-radius: 3px;"></div>
                            <span>&lt;10Â°C - Cold</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #5dade2; border-radius: 3px;"></div>
                            <span>10-18Â°C - Cool</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #2ecc71; border-radius: 3px;"></div>
                            <span>18-25Â°C - Comfortable (WHO recommended)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #f39c12; border-radius: 3px;"></div>
                            <span>25-30Â°C - Warm</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #e74c3c; border-radius: 3px;"></div>
                            <span>&gt;30Â°C - Hot</span>
                        </div>
                    </div>

                    <h4 style="font-size: 14px; margin: 16px 0 8px 0; color: var(--text-primary);">Humidity (Top Right)</h4>
                    <p style="font-size: 12px; margin-bottom: 8px;">Based on WHO indoor air quality guidelines and ASHRAE standards:</p>
                    <div style="display: grid; gap: 6px; font-size: 13px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #e67e22; border-radius: 3px;"></div>
                            <span>&lt;30% - Too dry (respiratory irritation)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #2ecc71; border-radius: 3px;"></div>
                            <span>30-60% - Comfortable (WHO/ASHRAE recommended)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #f39c12; border-radius: 3px;"></div>
                            <span>60-70% - Humid (mould risk increases)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #e74c3c; border-radius: 3px;"></div>
                            <span>&gt;70% - Very humid (high mould/bacteria risk)</span>
                        </div>
                    </div>

                    <h4 style="font-size: 14px; margin: 16px 0 8px 0; color: var(--text-primary);">Atmospheric Pressure (Bottom Left)</h4>
                    <p style="font-size: 12px; margin-bottom: 8px;">Based on meteorological standards (hPa/mbar):</p>
                    <div style="display: grid; gap: 6px; font-size: 13px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #e74c3c; border-radius: 3px;"></div>
                            <span>&lt;980 hPa - Very low (stormy conditions)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #f39c12; border-radius: 3px;"></div>
                            <span>980-1000 hPa - Low (rain likely)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #2ecc71; border-radius: 3px;"></div>
                            <span>1000-1020 hPa - Normal (standard pressure)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #5dade2; border-radius: 3px;"></div>
                            <span>1020-1040 hPa - High (fair weather)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #3498db; border-radius: 3px;"></div>
                            <span>&gt;1040 hPa - Very high (very dry air)</span>
                        </div>
                    </div>

                    <h4 style="font-size: 14px; margin: 16px 0 8px 0; color: var(--text-primary);">Carbon Dioxide (Bottom Right)</h4>
                    <p style="font-size: 12px; margin-bottom: 8px;">Based on WHO air quality guidelines and ASHRAE Standard 62.1:</p>
                    <div style="display: grid; gap: 6px; font-size: 13px; margin-bottom: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #2ecc71; border-radius: 3px;"></div>
                            <span>&lt;600 ppm - Excellent (outdoor air quality)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #f39c12; border-radius: 3px;"></div>
                            <span>600-1000 ppm - Acceptable (ASHRAE limit)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #e67e22; border-radius: 3px;"></div>
                            <span>1000-1500 ppm - Poor (drowsiness, reduced concentration)</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 20px; height: 20px; background: #e74c3c; border-radius: 3px;"></div>
                            <span>&gt;1500 ppm - Bad (headaches, fatigue, impaired cognition)</span>
                        </div>
                    </div>

                    <p style="font-size: 11px; margin-top: 12px; opacity: 0.7; font-style: italic;">
                        Note: Grey segments indicate no data available for that metric.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Details Sidebar Overlay -->
    <div class="details-sidebar-overlay" id="detailsSidebarOverlay"></div>

    <!-- Details Sidebar -->
    <div class="details-sidebar" id="detailsSidebar">
        <div class="details-sidebar-header">
            <button class="sidebar-back-btn" id="sidebarBackBtn">â†</button>
            <span class="sidebar-title" id="sidebarTitle">TEMPERATURE</span>
        </div>

        <div class="details-sidebar-content">
            <!-- Current Value Section -->
            <div class="details-current-section">
                <div class="details-current-label">Current</div>
                <div class="details-current-value">
                    <span id="sidebarCurrentValue">--</span>
                    <span class="details-current-unit" id="sidebarCurrentUnit">Â°C</span>
                </div>
                <div class="details-feels-like" id="sidebarFeelsLike">Feels like --Â°C</div>
            </div>

            <!-- Quick Stats Grid -->
            <div class="details-stats-grid">
                <div class="details-stat-card">
                    <div class="stat-card-label">1 HOUR AGO</div>
                    <div class="stat-card-value">
                        <span id="sidebar1hValue">--</span>
                        <span class="stat-card-diff negative" id="sidebar1hDiff">--</span>
                    </div>
                </div>
                <div class="details-stat-card">
                    <div class="stat-card-label">YESTERDAY</div>
                    <div class="stat-card-value">
                        <span id="sidebarYesterdayValue">--</span>
                        <span class="stat-card-diff positive" id="sidebarYesterdayDiff">--</span>
                    </div>
                </div>
                <div class="details-stat-card">
                    <div class="stat-card-label">LAST WEEK AVG</div>
                    <div class="stat-card-value">
                        <span id="sidebarWeekValue">--</span>
                        <span class="stat-card-diff positive" id="sidebarWeekDiff">--</span>
                    </div>
                </div>
                <div class="details-stat-card">
                    <div class="stat-card-label">TODAY'S RANGE</div>
                    <div class="stat-card-value range">
                        <span class="range-low" id="sidebarRangeLow">--</span>
                        <span class="range-arrow">â†’</span>
                        <span class="range-high" id="sidebarRangeHigh">--</span>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="details-chart-section">
                <div class="chart-header">
                    <span class="chart-title">History</span>
                    <select class="aq-metric-select" id="aqMetricSelect" style="display: none;">
                        <option value="pm2_5">PM2.5</option>
                        <option value="pm10">PM10</option>
                        <option value="pm1">PM1</option>
                        <option value="co2">COâ‚‚</option>
                        <option value="voc_index">VOC</option>
                        <option value="nox_index">NOx</option>
                    </select>
                </div>
                <!-- Time Pills -->
                <div class="details-time-pills">
                    <button class="time-pill" data-range="1h">1h</button>
                    <button class="time-pill" data-range="2h">2h</button>
                    <button class="time-pill" data-range="4h">4h</button>
                    <button class="time-pill" data-range="8h">8h</button>
                    <button class="time-pill active" data-range="24h">24h</button>
                    <button class="time-pill" data-range="48h">48h</button>
                    <button class="time-pill" data-range="7d">7d</button>
                    <button class="time-pill" data-range="30d">30d</button>
                    <button class="time-pill" data-range="90d">90d</button>
                    <button class="time-pill" data-range="1y">1y</button>
                    <button class="time-pill" data-range="all">All</button>
                </div>
                <div class="chart-container">
                    <canvas id="sidebarChart"></canvas>
                </div>
            </div>

            <!-- Period Stats (synced with chart time range) -->
            <div class="details-period-stats" id="detailsPeriodStats">
                <div class="period-stats-header">
                    <span class="period-stats-title">Period Statistics</span>
                    <span class="period-stats-range" id="periodStatsRange">Last 24h</span>
                </div>
                <div class="period-stats-grid">
                    <div class="period-stat">
                        <span class="period-stat-label">Min</span>
                        <span class="period-stat-value" id="periodStatMin">--</span>
                    </div>
                    <div class="period-stat">
                        <span class="period-stat-label">Max</span>
                        <span class="period-stat-value" id="periodStatMax">--</span>
                    </div>
                    <div class="period-stat">
                        <span class="period-stat-label">Avg</span>
                        <span class="period-stat-value" id="periodStatAvg">--</span>
                    </div>
                    <div class="period-stat">
                        <span class="period-stat-label">Range</span>
                        <span class="period-stat-value" id="periodStatRange">--</span>
                    </div>
                </div>
            </div>

            <!-- Contextual Insights -->
            <div class="details-insights" id="detailsInsights">
                <div class="insights-header">
                    <span class="insights-icon">ðŸ’¡</span>
                    <span class="insights-title">Insights</span>
                </div>
                <div class="insights-list" id="insightsList">
                    <!-- Insights will be populated dynamically -->
                </div>
            </div>

            <!-- Contributing Sensors (shown for pressure and other metrics) -->
            <div class="details-contributing-sensors" id="detailsContributingSensors" style="display: none;">
                <div class="contributing-sensors-header">
                    <span class="contributing-sensors-title">Contributing Sensors</span>
                    <span class="contributing-sensors-count" id="contributingSensorsCount">0</span>
                </div>
                <div class="contributing-sensors-list" id="contributingSensorsList">
                    <!-- Sensor items will be populated dynamically -->
                </div>
                <!-- Comparison chart showing all sensors overlaid -->
                <div class="contributing-sensors-comparison" id="contributingSensorsComparison" style="display: none;">
                    <div class="comparison-chart-header">
                        <span class="comparison-chart-title">Sensor Comparison</span>
                    </div>
                    <div class="comparison-chart-container">
                        <canvas id="sensorComparisonChart"></canvas>
                    </div>
                    <div class="comparison-chart-legend" id="comparisonChartLegend">
                        <!-- Legend items will be populated dynamically -->
                    </div>
                </div>
            </div>

            <!-- Sensor Info -->
            <div class="details-sensor-info">
                <div class="sensor-info-card">
                    <div class="sensor-info-label">SENSOR</div>
                    <div class="sensor-info-value" id="sidebarSensorName">--</div>
                    <div class="sensor-info-meta" id="sidebarLastUpdate">Updated --</div>
                </div>
                <div class="sensor-info-card">
                    <div class="sensor-info-label">VS REGION</div>
                    <div class="sensor-info-value" id="sidebarRegionValue">--</div>
                    <div class="sensor-info-meta" id="sidebarRegionDiff">--</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="details-actions" id="detailsActions">
                <button class="details-action-btn" id="fullChartsBtn">Full Charts</button>
                <button class="details-action-btn" id="exportDataBtn">Export Data</button>
            </div>

        </div>
    </div>

    <!-- Room Details Sidebar Overlay -->
    <div class="details-sidebar-overlay" id="roomDetailsSidebarOverlay"></div>

    <!-- Room Details Sidebar -->
    <div class="details-sidebar room-details-sidebar" id="roomDetailsSidebar">
        <div class="details-sidebar-header">
            <button class="sidebar-back-btn" id="roomSidebarBackBtn">â†</button>
            <span class="sidebar-title" id="roomSidebarTitle">Room Name</span>
        </div>

        <div class="details-sidebar-content">
            <!-- Current Insight/Advice -->
            <div class="room-insight-banner" id="roomInsightBanner">
                <span class="room-insight-icon" id="roomInsightIcon"></span>
                <span class="room-insight-text" id="roomInsightText">Air quality good</span>
            </div>

            <!-- Current Values Grid -->
            <div class="room-current-grid">
                <div class="room-metric-card" id="roomTempCard">
                    <div class="metric-label">Temperature</div>
                    <div class="metric-value">
                        <span id="roomTempValue">--</span>
                        <span class="metric-unit">Â°C</span>
                    </div>
                </div>
                <div class="room-metric-card" id="roomHumidityCard">
                    <div class="metric-label">Humidity</div>
                    <div class="metric-value">
                        <span id="roomHumidityValue">--</span>
                        <span class="metric-unit">%</span>
                    </div>
                </div>
                <div class="room-metric-card" id="roomCO2Card" style="display: none;">
                    <div class="metric-label">COâ‚‚</div>
                    <div class="metric-value">
                        <span id="roomCO2Value">--</span>
                        <span class="metric-unit">ppm</span>
                    </div>
                    <div class="metric-status" id="roomCO2Status"></div>
                </div>
                <div class="room-metric-card" id="roomPM25Card" style="display: none;">
                    <div class="metric-label">PM2.5</div>
                    <div class="metric-value">
                        <span id="roomPM25Value">--</span>
                        <span class="metric-unit">Âµg/mÂ³</span>
                    </div>
                    <div class="metric-status" id="roomPM25Status"></div>
                </div>
                <div class="room-metric-card" id="roomVOCCard" style="display: none;">
                    <div class="metric-label">VOC Index</div>
                    <div class="metric-value">
                        <span id="roomVOCValue">--</span>
                    </div>
                    <div class="metric-status" id="roomVOCStatus"></div>
                </div>
                <div class="room-metric-card" id="roomPressureCard" style="display: none;">
                    <div class="metric-label">Pressure</div>
                    <div class="metric-value">
                        <span id="roomPressureValue">--</span>
                        <span class="metric-unit">hPa</span>
                    </div>
                </div>
            </div>

            <!-- Chart Section -->
            <div class="details-chart-section">
                <div class="chart-header">
                    <span class="chart-title">History</span>
                    <select class="room-metric-select" id="roomMetricSelect">
                        <option value="temperature">Temperature</option>
                        <option value="humidity">Humidity</option>
                        <option value="co2">COâ‚‚</option>
                        <option value="pm2_5">PM2.5</option>
                        <option value="voc_index">VOC</option>
                    </select>
                </div>
                <!-- Time Pills -->
                <div class="details-time-pills" id="roomTimePills">
                    <button class="time-pill" data-range="1h">1h</button>
                    <button class="time-pill" data-range="4h">4h</button>
                    <button class="time-pill active" data-range="24h">24h</button>
                    <button class="time-pill" data-range="7d">7d</button>
                    <button class="time-pill" data-range="30d">30d</button>
                </div>
                <div class="chart-container">
                    <canvas id="roomHistoryChart"></canvas>
                </div>
            </div>

            <!-- Hardware Info -->
            <div class="room-device-info" id="roomDeviceInfo">
                <div class="device-info-label">Hardware Info</div>
                <div class="device-info-content" id="roomHardwareInfo">
                    <!-- Populated dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Sensor Management Panel Overlay -->
    <div class="sensor-panel-overlay" id="sensorPanelOverlay"></div>

    <!-- Sensor Management Panel -->
    <div class="sensor-panel" id="sensorPanel">
        <div class="sensor-panel-header">
            <button class="sensor-panel-close" id="sensorPanelClose">â†</button>
            <span class="sensor-panel-title">Manage Sensors</span>
            <span class="sensor-panel-count" id="sensorPanelCount">0 selected</span>
        </div>
        <div class="sensor-panel-search">
            <input type="text" id="sensorPanelSearch" placeholder="Search devices by name, ID, or location..." />
        </div>
        <div class="sensor-panel-content">
            <div class="sensor-panel-grid" id="sensorPanelGrid">
                <div class="loading">Loading sensors...</div>
            </div>
        </div>
        <div class="sensor-panel-footer">
            <button class="sensor-panel-view-all" id="sensorPanelViewAll">View All Sensors</button>
        </div>
    </div>

    <!-- Add Location Modal -->
    <div class="add-location-modal" id="addLocationModal">
        <div class="add-location-dialog">
            <div class="add-location-title">Add New Location</div>
            <input type="text" class="add-location-input" id="newLocationInput" placeholder="e.g., Office, Beach House, Parents..." maxlength="30">
            <div class="add-location-actions">
                <button class="add-location-btn cancel" id="cancelAddLocation">Cancel</button>
                <button class="add-location-btn confirm" id="confirmAddLocation">Add</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <!-- PMTiles + Protomaps for region boundaries (per architecture doc Section 6.1) -->
    <!-- Note: protomaps-leaflet@1.24.0 depends on pmtiles@2.7.0 -->
    <script src="https://unpkg.com/pmtiles@2.7.0/dist/index.js"></script>
    <script src="https://unpkg.com/protomaps-leaflet@1.24.0/dist/protomaps-leaflet.min.js"></script>
    <!-- Leaflet MarkerCluster -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.1/MarkerCluster.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.1/MarkerCluster.Default.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.1/leaflet.markercluster.min.js"></script>
    <!-- Leaflet Control Geocoder for place search -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.css">
    <script src="https://unpkg.com/leaflet-control-geocoder@2.4.0/dist/Control.Geocoder.js"></script>
    <!-- Chart.js for sparklines -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- Chart.js date adapter for time scales -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="/app.js"></script>
</body>
</html>
